(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},34858,e=>{"use strict";let t=(0,e.i(75254).default)("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);e.s(["Navigation",()=>t],34858)},64511,e=>{"use strict";var t=e.i(43476),s=e.i(932),l=e.i(71645);e.i(47167);var a=e.i(71725);e.i(50711);var r=e.i(82045),n=e.i(83394),o=e.i(67881),i=e.i(23750),c=e.i(94179);let d=(0,e.i(75254).default)("crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);var m=e.i(34858),u=e.i(7233),x=e.i(55436),h=e.i(37727),f=e.i(46897);function g({lifeDimension:e,onMarkerClick:s,onLocationSelect:g,ratingFilter:p}){let y=(0,l.useRef)(null),b=(0,l.useRef)(null),v=(0,l.useRef)([]),j=(0,l.useRef)(null),[w,N]=(0,l.useState)(!1),[S,k]=(0,l.useState)(!1),[C,_]=(0,l.useState)(null),[z,P]=(0,l.useState)(null),[$,E]=(0,l.useState)(""),[L,M]=(0,l.useState)([]),[I,T]=(0,l.useState)(!1),[R,B]=(0,l.useState)([]),D=(0,r.useQuery)(n.api.posts.getPostsForMap,{lifeDimension:e}),F=D?.filter(e=>!p||!(e.rating<p))||[];(0,l.useEffect)(()=>{if(y.current&&!b.current)return b.current=new a.default.Map({container:y.current,style:"mapbox://styles/malunao/cm84u5ecf000x01qled5j8bvl",center:[-98.5795,39.8283],zoom:4}),b.current.addControl(new a.default.NavigationControl,"top-right"),b.current.addControl(new a.default.FullscreenControl,"top-right"),b.current.on("load",()=>{N(!0),z&&b.current&&(b.current.setCenter(z.center),b.current.setZoom(z.zoom))}),b.current.on("moveend",()=>{b.current&&P({center:b.current.getCenter().toArray(),zoom:b.current.getZoom()})}),b.current.on("click",async e=>{if(!S||!g)return;let{lng:t,lat:s}=e.lngLat;try{let e=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${t},${s}.json?access_token=${a.default.accessToken}`),l=await e.json(),r=l.features[0]?.place_name||`${s.toFixed(4)}, ${t.toFixed(4)}`;b.current&&P({center:b.current.getCenter().toArray(),zoom:b.current.getZoom()}),g({lat:s,lng:t,address:r}),k(!1)}catch(e){console.error("Geocoding error:",e),b.current&&P({center:b.current.getCenter().toArray(),zoom:b.current.getZoom()}),g({lat:s,lng:t,address:`${s.toFixed(4)}, ${t.toFixed(4)}`}),k(!1)}}),()=>{v.current.forEach(e=>e.remove()),v.current=[],j.current&&j.current.remove(),b.current&&(b.current.remove(),b.current=null)}},[S,g]),(0,l.useEffect)(()=>{if(b.current&&w&&F&&(v.current.forEach(e=>e.remove()),v.current=[],F.forEach(e=>{if(!e.location||!b.current)return;let t=e.rating>=4?"#22c55e":e.rating>=3?"#eab308":"#ef4444",l=document.createElement("div");l.className="custom-marker",l.style.width="30px",l.style.height="30px",l.style.borderRadius="50%",l.style.backgroundColor=t,l.style.border="3px solid white",l.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",l.style.cursor="pointer",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.fontSize="14px",l.style.fontWeight="bold",l.style.color="white",l.textContent=e.rating.toString();let r=new a.default.Popup({offset:25}).setHTML(`
        <div style="padding: 8px; min-width: 200px;">
          <h3 style="font-weight: bold; margin-bottom: 4px;">${e.title}</h3>
          <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${e.location.name}</p>
          <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 4px;">
            <span style="font-size: 12px;">Rating: ${e.rating}/5</span>
          </div>
          <div style="font-size: 12px; color: #666;">
            ${e.verificationCount} verification${1!==e.verificationCount?"s":""}
            ${e.isVerified?' • <span style="color: #22c55e;">✓ Verified</span>':""}
          </div>
        </div>
      `),n=new a.default.Marker(l).setLngLat(e.location.coordinates).setPopup(r).addTo(b.current);l.addEventListener("click",()=>{s&&s(e._id)}),v.current.push(n)}),F.length>0&&b.current&&!z)){let e=new a.default.LngLatBounds;F.forEach(t=>{t.location&&e.extend(t.location.coordinates)}),b.current.fitBounds(e,{padding:50,maxZoom:12})}},[F,w,s,z]),(0,l.useEffect)(()=>{if(b.current&&w&&C)if(j.current)j.current.setLngLat([C.lng,C.lat]);else{let e=document.createElement("div");e.className="user-location-marker",e.style.width="20px",e.style.height="20px",e.style.borderRadius="50%",e.style.backgroundColor="#3b82f6",e.style.border="3px solid white",e.style.boxShadow="0 0 10px rgba(59, 130, 246, 0.5)",j.current=new a.default.Marker(e).setLngLat([C.lng,C.lat]).setPopup(new a.default.Popup({offset:25}).setHTML('<div style="padding: 8px;"><strong>Your Location</strong></div>')).addTo(b.current)}},[C,w]);let Z=async()=>{if($.trim()){T(!0);try{let e=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent($)}.json?access_token=${a.default.accessToken}&limit=5`),t=await e.json();M(t.features||[])}catch(e){console.error("Search error:",e)}finally{T(!1)}}};return(0,t.jsxs)("div",{className:"relative w-full h-full",children:[(0,t.jsx)("div",{ref:y,className:`w-full h-full rounded-lg ${S?"cursor-crosshair":""}`}),(0,t.jsxs)("div",{className:"absolute top-4 left-4 right-20 z-10 max-w-md",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(i.Input,{type:"text",placeholder:"Search location...",value:$,onChange:e=>E(e.target.value),onKeyDown:e=>"Enter"===e.key&&Z(),className:"bg-white shadow-lg pr-10"}),(0,t.jsx)(o.Button,{onClick:Z,size:"icon",className:"absolute right-0 top-0 h-full",variant:"ghost",children:(0,t.jsx)(x.Search,{className:"w-4 h-4"})})]}),L.length>0&&(0,t.jsx)("div",{className:"mt-2 bg-white rounded-lg shadow-lg max-h-60 overflow-y-auto",children:L.map((e,s)=>(0,t.jsxs)("button",{onClick:()=>(e=>{if(!b.current)return;let[t,s]=e.center;b.current.flyTo({center:[t,s],zoom:14,duration:2e3,essential:!0}),E(""),M([]),D&&B(D.filter(e=>{if(!e.location)return!1;let[l,a]=e.location.coordinates;return .1>Math.sqrt(Math.pow(l-t,2)+Math.pow(a-s,2))}))})(e),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b last:border-b-0 flex items-start gap-2",children:[(0,t.jsx)(f.MapPin,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-sm truncate",children:e.text}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.place_name})]})]},s))})]}),(0,t.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col gap-2 z-10",children:[(0,t.jsx)(o.Button,{onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:s}=e.coords;_({lat:t,lng:s}),b.current&&(b.current.flyTo({center:[s,t],zoom:14,duration:2e3,essential:!0}),D&&B(D.filter(e=>{if(!e.location)return!1;let[l,a]=e.location.coordinates;return .1>Math.sqrt(Math.pow(l-s,2)+Math.pow(a-t,2))})))},e=>{console.error("Error getting location:",e),alert("Unable to get your location. Please enable location services.")}):alert("Geolocation is not supported by your browser")},className:"bg-white text-gray-700 hover:bg-gray-100 shadow-lg",size:"icon",title:"Go to my location",children:(0,t.jsx)(m.Navigation,{className:"w-5 h-5"})}),g&&(0,t.jsx)(o.Button,{onClick:()=>k(!S),className:`shadow-lg ${S?"bg-purple-600 text-white hover:bg-purple-700":"bg-white text-gray-700 hover:bg-gray-100"}`,size:"icon",title:"Click map to select location",children:S?(0,t.jsx)(d,{className:"w-5 h-5"}):(0,t.jsx)(u.Plus,{className:"w-5 h-5"})})]}),S&&(0,t.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-purple-600 text-white px-4 py-2 rounded-lg shadow-lg z-10",children:(0,t.jsx)("p",{className:"text-sm font-medium",children:"Click anywhere on the map to select a location"})}),(0,t.jsxs)("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 z-10",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm mb-2",children:"Safety Rating"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"text-xs",children:"Safe (4-5)"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),(0,t.jsx)("span",{className:"text-xs",children:"Neutral (3)"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full bg-red-500"}),(0,t.jsx)("span",{className:"text-xs",children:"Unsafe (1-2)"})]})]})]}),R.length>0&&(0,t.jsxs)("div",{className:"absolute bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 z-10 max-w-xs max-h-80 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h4",{className:"font-semibold text-sm",children:["Nearby Locations (",R.length,")"]}),(0,t.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>B([]),children:(0,t.jsx)(h.X,{className:"w-4 h-4"})})]}),(0,t.jsx)("div",{className:"space-y-2",children:R.map(e=>(0,t.jsx)("button",{onClick:()=>s&&s(e._id),className:"w-full text-left p-2 hover:bg-gray-50 rounded border",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(c.Badge,{className:`flex-shrink-0 ${e.rating>=4?"bg-green-500":e.rating>=3?"bg-yellow-500":"bg-red-500"}`,children:e.rating}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-xs truncate",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.location?.name})]})]})},e._id))})]})]})}a.default.accessToken="pk.eyJ1IjoibWFsdW5hbyIsImEiOiJjbGNnZTBrd2EyYmRjM29uMndzZDZ2cWRxIn0.7ffmNPdwDu1nU-PkgFgEsw";var p=e.i(83258),y=e.i(62870);function b(){let e,a,r,n,i,c,d,m,x,h,b,v,j,w,N,S=(0,s.c)(24),[k,C]=(0,l.useState)(void 0),[_,z]=(0,l.useState)(!1),[P,$]=(0,l.useState)(null),[E,L]=(0,l.useState)(null);S[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{(async()=>{try{let e=await fetch("/api/auth/me"),t=await e.json();t.userId&&L(t.userId)}catch(e){console.error("Error getting user:",e)}})()},a=[],S[0]=e,S[1]=a):(e=S[0],a=S[1]),(0,l.useEffect)(e,a),S[2]===Symbol.for("react.memo_cache_sentinel")?(r=e=>{$(e),z(!0)},S[2]=r):r=S[2];let M=r;S[3]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)(f.MapPin,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-600 flex-shrink-0 mt-1"}),S[3]=n):n=S[3],S[4]===Symbol.for("react.memo_cache_sentinel")?(i=(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[n,(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"Safety Map"}),(0,t.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Click + to mark a location"})]})]}),S[4]=i):i=S[4];let I=k||"all";return S[5]===Symbol.for("react.memo_cache_sentinel")?(c=e=>C("all"===e?void 0:e),S[5]=c):c=S[5],S[6]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)(y.SelectTrigger,{className:"w-full sm:w-[200px]",children:(0,t.jsx)(y.SelectValue,{placeholder:"All Dimensions"})}),S[6]=d):d=S[6],S[7]===Symbol.for("react.memo_cache_sentinel")?(m=(0,t.jsxs)(y.SelectContent,{children:[(0,t.jsx)(y.SelectItem,{value:"all",children:"All Dimensions"}),(0,t.jsx)(y.SelectItem,{value:"professional",children:"Professional"}),(0,t.jsx)(y.SelectItem,{value:"social",children:"Social"}),(0,t.jsx)(y.SelectItem,{value:"daily",children:"Daily Life"}),(0,t.jsx)(y.SelectItem,{value:"travel",children:"Travel"}),(0,t.jsx)(y.SelectItem,{value:"financial",children:"Financial"})]}),S[7]=m):m=S[7],S[8]!==I?(x=(0,t.jsxs)(y.Select,{value:I,onValueChange:c,children:[d,m]}),S[8]=I,S[9]=x):x=S[9],S[10]===Symbol.for("react.memo_cache_sentinel")?(h=()=>z(!0),S[10]=h):h=S[10],S[11]===Symbol.for("react.memo_cache_sentinel")?(b=(0,t.jsxs)(o.Button,{onClick:h,className:"w-full sm:w-auto",children:[(0,t.jsx)(u.Plus,{className:"w-4 h-4 mr-2"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Create Post"}),(0,t.jsx)("span",{className:"sm:hidden",children:"New Post"})]}),S[11]=b):b=S[11],S[12]!==x?(v=(0,t.jsx)("div",{className:"bg-white border-b",children:(0,t.jsx)("div",{className:"px-4 sm:px-6 py-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[i,(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[x,b]})]})})}),S[12]=x,S[13]=v):v=S[13],S[14]!==k?(j=(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(g,{lifeDimension:k,onLocationSelect:M})}),S[14]=k,S[15]=j):j=S[15],S[16]!==P?.address||S[17]!==_||S[18]!==E?(w=E&&(0,t.jsx)(p.PostCreateDialog,{open:_,onOpenChange:z,userId:E,prefilledLocation:P?.address}),S[16]=P?.address,S[17]=_,S[18]=E,S[19]=w):w=S[19],S[20]!==v||S[21]!==j||S[22]!==w?(N=(0,t.jsxs)("div",{className:"h-screen flex flex-col bg-gray-50",children:[v,j,w]}),S[20]=v,S[21]=j,S[22]=w,S[23]=N):N=S[23],N}e.s(["default",()=>b],64511)}]);