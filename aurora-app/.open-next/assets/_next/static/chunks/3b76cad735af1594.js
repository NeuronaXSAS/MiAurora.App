(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25652,e=>{"use strict";let t=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>t],25652)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},52044,e=>{"use strict";let t=(0,e.i(75254).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],52044)},56458,e=>{"use strict";var t=e.i(43476),a=e.i(71645);e.i(50711);var s=e.i(82045),r=e.i(83394);let i=null;async function l(){if(!("wakeLock"in navigator))return console.warn("Wake Lock API not supported"),!1;try{return(i=await navigator.wakeLock.request("screen")).addEventListener("release",()=>{console.log("Wake Lock released")}),console.log("Wake Lock acquired"),!0}catch(e){return console.error("Wake Lock request failed:",e),!1}}async function n(){if(i)try{await i.release(),i=null,console.log("Wake Lock manually released")}catch(e){console.error("Wake Lock release failed:",e)}}"undefined"!=typeof document&&(document.addEventListener("visibilitychange",async()=>{null!==i&&"visible"===document.visibilityState&&(console.log("Page visible - re-acquiring wake lock"),await l())}),window.addEventListener("focus",async()=>{null!==i&&(console.log("Window focused - ensuring wake lock"),await l())}));let o=new class{watchId=null;state={isTracking:!1,coordinates:[],distance:0,duration:0,startTime:null};coordinateCallbacks=[];statsCallbacks=[];statsInterval=null;async startTracking(){return this.state.isTracking?(console.warn("Tracking already active"),!1):(await l()||console.warn("Wake lock not acquired, tracking may be interrupted"),navigator.geolocation)?(this.watchId=navigator.geolocation.watchPosition(e=>this.handlePosition(e),e=>this.handleError(e),{enableHighAccuracy:!0,maximumAge:0,timeout:5e3}),this.state.isTracking=!0,this.state.startTime=Date.now(),this.state.coordinates=[],this.state.distance=0,this.state.duration=0,this.statsInterval=setInterval(()=>{this.state.startTime&&(this.state.duration=Math.floor((Date.now()-this.state.startTime)/1e3),this.notifyStatsCallbacks())},1e3),console.log("Real-time GPS tracking started"),!0):(console.error("Geolocation not supported"),!1)}async stopTracking(){return this.state.isTracking?(null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=null),await n(),this.state.isTracking=!1,console.log("Real-time GPS tracking stopped"),{...this.state}):(console.warn("Tracking not active"),this.state)}handlePosition(e){let t={lat:e.coords.latitude,lng:e.coords.longitude,timestamp:Date.now(),accuracy:e.coords.accuracy};if(this.state.coordinates.length>0){let e=this.state.coordinates[this.state.coordinates.length-1],a=this.calculateDistance(e.lat,e.lng,t.lat,t.lng);this.state.distance+=a}this.state.coordinates.push(t),this.notifyCoordinateCallbacks(t)}handleError(e){switch(console.error("GPS error:",e.message),e.code){case e.PERMISSION_DENIED:console.error("User denied geolocation permission");break;case e.POSITION_UNAVAILABLE:console.error("Location information unavailable");break;case e.TIMEOUT:console.error("Location request timed out")}}calculateDistance(e,t,a,s){let r=e*Math.PI/180,i=a*Math.PI/180,l=(a-e)*Math.PI/180,n=(s-t)*Math.PI/180,o=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r)*Math.cos(i)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371e3}onCoordinate(e){return this.coordinateCallbacks.push(e),()=>{this.coordinateCallbacks=this.coordinateCallbacks.filter(t=>t!==e)}}onStats(e){return this.statsCallbacks.push(e),()=>{this.statsCallbacks=this.statsCallbacks.filter(t=>t!==e)}}notifyCoordinateCallbacks(e){this.coordinateCallbacks.forEach(t=>{try{t(e)}catch(e){console.error("Error in coordinate callback:",e)}})}notifyStatsCallbacks(){let e={distance:this.state.distance,duration:this.state.duration};this.statsCallbacks.forEach(t=>{try{t(e)}catch(e){console.error("Error in stats callback:",e)}})}getState(){return{...this.state}}isWakeLockActive(){return null!==i&&!i.released}};var c=e.i(67881),d=e.i(70065),h=e.i(31343),u=e.i(52044),m=e.i(46897),g=e.i(3116),x=e.i(25652);let f=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function k(){let[e,i]=(0,a.useState)(!1),[l,n]=(0,a.useState)(!1),[k,p]=(0,a.useState)(0),[v,y]=(0,a.useState)(0),[b,w]=(0,a.useState)([]),[j,N]=(0,a.useState)(null),[S,T]=(0,a.useState)(null),[C,I]=(0,a.useState)(!1),[M,E]=(0,a.useState)(0),[P,L]=(0,a.useState)(!1),q=(0,s.useMutation)(r.api.routes.startRoute),A=(0,s.useMutation)(r.api.routes.saveCoordinates),R=(0,s.useMutation)(r.api.routes.completeRoute);(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me"),t=await e.json();t.userId&&N(t.userId)}catch(e){console.error("Error getting user:",e)}})()},[]),(0,a.useEffect)(()=>{let e,t=[],a=o.onCoordinate(async e=>{w(t=>[...t,e]),t.push(e)});S&&(e=setInterval(async()=>{if(t.length>0&&S)try{await A({routeId:S,coordinates:t.map(e=>({lat:e.lat,lng:e.lng,timestamp:e.timestamp}))}),t=[]}catch(e){console.error("Error streaming coordinates:",e)}},5e3));let s=o.onStats(e=>{p(e.distance),y(e.duration)});return()=>{a(),s(),e&&clearInterval(e)}},[S,A]);let W=async()=>{if(!j)return void alert("Please log in to track routes");try{if(!await o.startTracking())return void alert("Failed to start GPS tracking. Please check permissions.");let e=await q({userId:j,routeType:"walking"});T(e.routeId),i(!0),I(o.isWakeLockActive()),w([]),p(0),y(0),setTimeout(()=>{n(!0)},3e3)}catch(e){console.error("Error starting route:",e),alert("Failed to start tracking: "+e.message)}},D=e=>{if("touches"in e){let t=e.touches[0],a=e.target.closest(".slide-container");if(!a)return;let s=a.getBoundingClientRect(),r=Math.max(0,Math.min(t.clientX-s.left,s.width-60));E(r),r>.8*s.width&&G()}},U=()=>{L(!1),M<200&&E(0)},G=async()=>{if(S&&j)try{let e=await o.stopTracking(),t=b[0],a=b[b.length-1];await R({routeId:S,userId:j,distance:e.distance,duration:e.duration,elevationGain:0,rating:3,tags:[],sharingLevel:"public",startLocation:t?{name:"Start",lat:t.lat,lng:t.lng}:{name:"Unknown",lat:0,lng:0},endLocation:a?{name:"End",lat:a.lat,lng:a.lng}:{name:"Unknown",lat:0,lng:0}}),i(!1),n(!1),I(!1),T(null),alert("Route saved successfully!")}catch(e){console.error("Error stopping route:",e),alert("Failed to save route: "+e.message)}},O=e=>{let t=Math.floor(e/60);return`${t}:${(e%60).toString().padStart(2,"0")}`},B=e=>(e/1e3).toFixed(2);return l&&e?(0,t.jsxs)("div",{className:"fixed inset-0 bg-black flex flex-col items-center justify-center",children:[(0,t.jsxs)("div",{className:"text-center space-y-8",children:[(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-red-600 rounded-full animate-pulse"}),(0,t.jsx)("div",{className:"absolute inset-0 w-4 h-4 bg-red-600 rounded-full animate-ping opacity-75"})]})}),(0,t.jsx)("div",{className:"text-gray-700 text-4xl font-mono font-light",children:O(v)}),(0,t.jsxs)("div",{className:"text-gray-800 text-xl font-light",children:[B(k)," km"]}),(0,t.jsxs)("div",{className:"text-gray-800 text-sm",children:[b.length," points"]})]}),(0,t.jsxs)("div",{className:"absolute bottom-8 left-4 right-4",children:[(0,t.jsx)("button",{onClick:()=>{confirm("Trigger emergency alert?")&&alert("Emergency services notified")},className:"w-full mb-4 py-3 bg-red-900 text-red-200 rounded-lg text-sm font-medium",children:"SOS / Emergency"}),(0,t.jsxs)("div",{className:"slide-container relative bg-gray-900 rounded-full h-16 overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 bg-red-900 transition-all",style:{width:`${M/250*100}%`}}),(0,t.jsx)("div",{className:"absolute top-2 left-2 w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center cursor-pointer touch-none",style:{transform:`translateX(${M}px)`},onTouchStart:()=>L(!0),onTouchMove:D,onTouchEnd:U,onMouseDown:()=>L(!0),onMouseMove:e=>P&&D(e),onMouseUp:U,children:(0,t.jsx)(u.Square,{className:"w-6 h-6 text-gray-400"})}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,t.jsx)("span",{className:"text-gray-600 text-sm font-medium",children:"Slide to finish â†’"})})]}),(0,t.jsx)("button",{onClick:()=>n(!1),className:"w-full mt-3 py-2 text-gray-700 text-xs",children:"Show interface"})]})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-purple-50 to-white p-4",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Track Your Route"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Record your journey with real-time GPS tracking"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[(0,t.jsxs)(d.Card,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(x.TrendingUp,{className:"w-4 h-4 text-purple-600"}),(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Distance"})]}),(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[B(k)," km"]})]}),(0,t.jsxs)(d.Card,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(g.Clock,{className:"w-4 h-4 text-purple-600"}),(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Time"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:O(v)})]})]}),e&&(0,t.jsx)(d.Card,{className:"p-3 mb-6 bg-green-50 border-green-200",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f,{className:`w-4 h-4 ${C?"text-green-600":"text-yellow-600"}`}),(0,t.jsx)("span",{className:"text-sm font-medium",children:C?"Screen lock active - tracking in background":"Screen lock unavailable"})]})}),(0,t.jsxs)(d.Card,{className:"p-4 mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.MapPin,{className:"w-5 h-5 text-purple-600"}),(0,t.jsx)("span",{className:"font-medium",children:"GPS Points"})]}),(0,t.jsx)("span",{className:"text-2xl font-bold text-purple-600",children:b.length})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-2",children:"Streaming to cloud in real-time"})]}),(0,t.jsx)("div",{className:"fixed bottom-24 left-0 right-0 px-4 space-y-3",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(c.Button,{onClick:()=>n(!0),className:"w-full h-12 bg-gray-900 hover:bg-black text-white",children:[(0,t.jsx)(f,{className:"w-5 h-5 mr-2"}),"Enable Stealth Mode"]}),(0,t.jsxs)(c.Button,{onClick:G,variant:"destructive",className:"w-full h-16 text-lg",children:[(0,t.jsx)(u.Square,{className:"w-6 h-6 mr-2"}),"Stop & Save"]})]}):(0,t.jsxs)(c.Button,{onClick:W,className:"w-full h-16 text-lg bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",disabled:!j,children:[(0,t.jsx)(h.Play,{className:"w-6 h-6 mr-2"}),"Start Tracking"]})}),!e&&(0,t.jsxs)("div",{className:"mt-8 text-center text-sm text-gray-600 space-y-2",children:[(0,t.jsx)("p",{className:"font-medium",children:"ðŸŒ™ Stealth Mode Available"}),(0,t.jsx)("p",{children:"Track routes with black screen (OLED battery saver)"}),(0,t.jsx)("p",{className:"text-xs",children:"GPS stays active â€¢ Slide to finish â€¢ SOS button included"})]})]})}e.s(["default",()=>k],56458)}]);