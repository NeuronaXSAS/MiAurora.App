(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25652,e=>{"use strict";let t=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>t],25652)},27612,e=>{"use strict";let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],27612)},61911,e=>{"use strict";let t=(0,e.i(75254).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],61911)},9835,e=>{"use strict";let t="offline-routes";function s(e,t,s,a){let i=e*Math.PI/180,r=s*Math.PI/180,l=(s-e)*Math.PI/180,n=(a-t)*Math.PI/180,o=Math.sin(l/2)*Math.sin(l/2)+Math.cos(i)*Math.cos(r)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371e3}async function a(e,s){let a=await new Promise((e,s)=>{let a=indexedDB.open("aurora-routes",1);a.onerror=()=>s(a.error),a.onsuccess=()=>e(a.result),a.onupgradeneeded=e=>{let s=e.target.result;s.objectStoreNames.contains(t)||s.createObjectStore(t,{keyPath:"id",autoIncrement:!0})}}),i=a.transaction([t],"readwrite").objectStore(t);await new Promise((t,a)=>{let r=i.put({routeId:e,coordinates:s,timestamp:Date.now()});r.onsuccess=()=>t(),r.onerror=()=>a(r.error)}),a.close()}class i{watchId=null;state={isTracking:!1,isPaused:!1,coordinates:[],stats:{distance:0,duration:0,pace:0,elevationGain:0},startTime:null,pausedTime:0};lastSampleTime=0;lastSamplePosition=null;onUpdate=null;onError=null;start(e,t){this.state.isTracking||(this.onUpdate=e,this.onError=t||null,this.state.isTracking=!0,this.state.isPaused=!1,this.state.startTime=Date.now(),this.lastSampleTime=Date.now(),"geolocation"in navigator?this.watchId=navigator.geolocation.watchPosition(e=>this.handlePosition(e),e=>this.handleError(e),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):this.handleError({code:0,message:"Geolocation not supported"}))}pause(){this.state.isTracking&&!this.state.isPaused&&(this.state.isPaused=!0,this.notifyUpdate())}resume(){this.state.isTracking&&this.state.isPaused&&(this.state.isPaused=!1,this.state.pausedTime+=Date.now()-(this.lastSampleTime||Date.now()),this.lastSampleTime=Date.now(),this.notifyUpdate())}stop(){return null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.state.isTracking=!1,this.state.isPaused=!1,this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),{...this.state}}getState(){return{...this.state}}handlePosition(e){if(!this.state.isTracking||this.state.isPaused)return;let t={lat:e.coords.latitude,lng:e.coords.longitude,timestamp:e.timestamp,elevation:e.coords.altitude||void 0};this.shouldSample(t)&&(this.state.coordinates.push(t),this.lastSamplePosition=t,this.lastSampleTime=Date.now(),this.updateStats(),this.notifyUpdate(),this.state.coordinates.length%10==0&&this.saveToOfflineStorage())}shouldSample(e){return!!(!this.lastSamplePosition||Date.now()-this.lastSampleTime>=5e3||s(this.lastSamplePosition.lat,this.lastSamplePosition.lng,e.lat,e.lng)>=10)}updateStats(){this.state.stats.distance=function(e){if(e.length<2)return 0;let t=0;for(let a=1;a<e.length;a++)t+=s(e[a-1].lat,e[a-1].lng,e[a].lat,e[a].lng);return t}(this.state.coordinates),this.state.stats.elevationGain=function(e){if(e.length<2)return 0;let t=0;for(let s=1;s<e.length;s++){let a=e[s-1].elevation||0,i=e[s].elevation||0;i>a&&(t+=i-a)}return t}(this.state.coordinates),this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),this.state.stats.distance>0&&this.state.stats.duration>0&&(this.state.stats.pace=this.state.stats.duration/60/(this.state.stats.distance/1e3))}handleError(e){console.error("GPS Error:",e),this.onError&&this.onError(e)}notifyUpdate(){this.onUpdate&&this.onUpdate({...this.state})}async saveToOfflineStorage(){try{await a("current",this.state.coordinates)}catch(e){console.error("Failed to save offline route:",e)}}}function r(e){let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return t>0?`${t}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${s}:${a.toString().padStart(2,"0")}`}function l(e){return e>=1e3?`${(e/1e3).toFixed(2)} km`:`${Math.round(e)} m`}function n(e){if(!isFinite(e)||0===e)return"--:--";let t=Math.floor(e),s=Math.round((e-t)*60);return`${t}:${s.toString().padStart(2,"0")}`}e.s(["GPSTracker",()=>i,"formatDistance",()=>l,"formatDuration",()=>r,"formatPace",()=>n])},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},34858,e=>{"use strict";let t=(0,e.i(75254).default)("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);e.s(["Navigation",()=>t],34858)},55833,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(50711);var a=e.i(82045),i=e.i(83394),r=e.i(67881),l=e.i(70065),n=e.i(84762),o=e.i(71689),c=e.i(46897),d=e.i(3116),h=e.i(25652),m=e.i(70273),u=e.i(61911),x=e.i(31343);let p=(0,e.i(75254).default)("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);var g=e.i(86311),j=e.i(34858),f=e.i(27612),y=e.i(18566),N=e.i(9835),v=e.i(94913);let b=["safe","inspiring","challenging","healing","accessible","beautiful","quiet","scenic","well-lit","busy"];function w(){let e=(0,y.useParams)().routeId,[w,k]=(0,s.useState)(null),[C,S]=(0,s.useState)(!1),[T,P]=(0,s.useState)(0),[M,D]=(0,s.useState)([]),[I,E]=(0,s.useState)(""),[U,R]=(0,s.useState)(!1),$=(0,y.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me"),t=await e.json();t.userId&&k(t.userId)}catch(e){console.error("Error getting user:",e)}})()},[]);let B=(0,a.useQuery)(i.api.routes.getRoute,e?{routeId:e}:"skip"),z=(0,a.useMutation)(i.api.routes.completeCommunityRoute),A=(0,a.useMutation)(i.api.routes.deleteRoute),F=async()=>{if(w&&confirm("Are you sure you want to delete this route? All GPS data, ratings, and reviews will be permanently removed."))try{await A({routeId:e,userId:w}),$.push("/routes")}catch(e){console.error("Error deleting route:",e),alert("Failed to delete route: "+e.message)}},L=async()=>{if(!w||0===T)return void alert("Please provide a rating");R(!0);try{await z({routeId:e,userId:w,userRating:T,userTags:M,feedback:I||void 0}),S(!1),alert("Thank you for completing this route! The creator has been awarded 5 credits.")}catch(e){alert(e.message||"Failed to submit completion")}finally{R(!1)}};if(!B)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading route..."})]})});let O=B.duration>0?B.distance/(B.duration/60):0,G=B.verificationCount>0?B.totalRating/B.verificationCount:B.rating;return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"bg-white border-b sticky top-16 lg:top-0 z-10",children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(r.Button,{variant:"ghost",onClick:()=>$.push("/routes/discover"),children:[(0,t.jsx)(o.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Discovery"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(p,{className:"w-4 h-4 mr-2"}),"Save"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>$.push(`/routes/navigate/${e}`),children:[(0,t.jsx)(j.Navigation,{className:"w-4 h-4 mr-2"}),"Navigate"]}),(0,t.jsxs)(r.Button,{size:"sm",onClick:()=>S(!0),children:[(0,t.jsx)(x.Play,{className:"w-4 h-4 mr-2"}),"Start This Route"]}),w===B?.creatorId&&(0,t.jsx)(r.Button,{variant:"destructive",size:"sm",onClick:F,children:(0,t.jsx)(f.Trash2,{className:"w-4 h-4"})})]})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-6 sm:py-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:B.title}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,t.jsxs)("span",{children:["Created by ",B.creator.name]}),(0,t.jsx)("span",{children:"â€¢"}),(0,t.jsx)("span",{children:(0,v.formatDistanceToNow)(B._creationTime,{addSuffix:!0})})]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:B.tags.map((e,s)=>(0,t.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-sm rounded-full",children:e},s))}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"w-full h-96 bg-gradient-to-br from-purple-100 to-blue-100 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(c.MapPin,{className:"w-16 h-16 text-purple-600 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Route map preview"})]})})})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(h.TrendingUp,{className:"w-4 h-4 text-gray-500"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Distance"})]}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:(0,N.formatDistance)(B.distance)})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(d.Clock,{className:"w-4 h-4 text-gray-500"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Duration"})]}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:(0,N.formatDuration)(B.duration)})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(m.Star,{className:"w-4 h-4 text-yellow-500"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Rating"})]}),(0,t.jsxs)("p",{className:"text-2xl font-bold",children:[G.toFixed(1),"/5"]})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(u.Users,{className:"w-4 h-4 text-gray-500"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Completed"})]}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:B.completionCount})]})})]}),B.journalEntry&&(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsxs)("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(g.MessageSquare,{className:"w-5 h-5"}),"Creator's Notes"]}),(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:B.journalEntry})]})}),B.voiceNoteStorageId&&(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsx)("h3",{className:"font-semibold mb-3",children:"Voice Note"}),(0,t.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,t.jsx)("source",{src:`/api/files/${B.voiceNoteStorageId}`,type:"audio/webm"}),"Your browser does not support audio playback."]})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsx)("h3",{className:"font-semibold mb-4",children:"Route Details"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(c.MapPin,{className:"w-5 h-5 text-green-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Start"}),(0,t.jsx)("p",{className:"font-medium",children:B.startLocation.name})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(c.MapPin,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"End"}),(0,t.jsx)("p",{className:"font-medium",children:B.endLocation.name})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(x.Play,{className:"w-5 h-5 text-gray-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Pace"}),(0,t.jsx)("p",{className:"font-medium",children:(0,N.formatPace)(O)})]})]})]})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsx)("h3",{className:"font-semibold mb-4",children:"Community Feedback"}),(0,t.jsxs)("p",{className:"text-gray-600 text-sm",children:[B.verificationCount," ",1===B.verificationCount?"person has":"people have"," completed this route"]})]})})]})}),C&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:(0,t.jsx)(l.Card,{className:"max-w-2xl w-full my-8",children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Complete This Route"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Share your experience to help other women and earn credits!"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Your Rating *"}),(0,t.jsx)("div",{className:"flex gap-2",children:[1,2,3,4,5].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>P(e),className:"focus:outline-none",children:(0,t.jsx)(m.Star,{className:`w-10 h-10 transition-colors ${e<=T?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200"}`})},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Tags (Optional)"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{D(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${M.includes(e)?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Feedback (Optional)"}),(0,t.jsx)(n.Textarea,{placeholder:"Share your thoughts about this route...",value:I,onChange:e=>E(e.target.value),rows:4,maxLength:500}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[I.length,"/500 characters"]})]}),(0,t.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-sm text-purple-900",children:"The route creator will earn 5 credits when you complete their route!"})}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>S(!1),disabled:U,className:"flex-1",children:"Cancel"}),(0,t.jsx)(r.Button,{onClick:L,disabled:U||0===T,className:"flex-1",children:U?"Submitting...":"Submit Completion"})]})]})]})})})]})}e.s(["default",()=>w],55833)}]);