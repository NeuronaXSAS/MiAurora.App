(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},14764,e=>{"use strict";let s=(0,e.i(75254).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>s],14764)},66876,e=>{"use strict";var s=e.i(43476),a=e.i(71645);e.i(50711);var r=e.i(82045),t=e.i(83394),i=e.i(67881),l=e.i(84762),n=e.i(63270),c=e.i(71689),d=e.i(14764),o=e.i(18566),x=e.i(94913);function m(){let e=(0,o.useParams)().userId,[m,u]=(0,a.useState)(null),[h,p]=(0,a.useState)(""),[f,g]=(0,a.useState)(!1),j=(0,a.useRef)(null),y=(0,o.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me"),s=await e.json();s.userId&&u(s.userId)}catch(e){console.error("Error getting user:",e)}})()},[]);let v=(0,r.useQuery)(t.api.directMessages.getConversation,m?{userId:m,otherUserId:e}:"skip"),N=(0,r.useQuery)(t.api.users.getUser,e?{userId:e}:"skip"),b=(0,r.useMutation)(t.api.directMessages.send),w=(0,r.useMutation)(t.api.directMessages.markAsRead);(0,a.useEffect)(()=>{m&&e&&w({userId:m,otherUserId:e})},[m,e,v]),(0,a.useEffect)(()=>{j.current?.scrollIntoView({behavior:"smooth"})},[v]);let k=async()=>{if(m&&h.trim()){g(!0);try{await b({senderId:m,receiverId:e,content:h.trim()}),p("")}catch(e){console.error("Send error:",e),alert("Failed to send message")}finally{g(!1)}}};return(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white border-b flex-shrink-0",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>y.push("/messages"),children:(0,s.jsx)(c.ArrowLeft,{className:"w-5 h-5"})}),(0,s.jsxs)(n.Avatar,{children:[(0,s.jsx)(n.AvatarImage,{src:N?.profileImage}),(0,s.jsx)(n.AvatarFallback,{children:N?.name?.charAt(0).toUpperCase()||"U"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-semibold",children:N?.name||"Loading..."}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Trust Score: ",N?.trustScore||0]})]})]})})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[!v&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading messages..."})]}),v&&0===v.length&&(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-600",children:"No messages yet. Start the conversation!"})}),v&&v.map(e=>{let a=e.senderId===m;return(0,s.jsx)("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[70%] ${a?"bg-purple-600 text-white":"bg-white text-gray-900"} rounded-2xl px-4 py-2 shadow-sm`,children:[!a&&(0,s.jsx)("p",{className:"text-xs font-semibold mb-1",children:e.sender?.name}),(0,s.jsx)("p",{className:"whitespace-pre-wrap break-words",children:e.content}),(0,s.jsx)("p",{className:`text-xs mt-1 ${a?"text-purple-200":"text-gray-500"}`,children:(0,x.formatDistanceToNow)(e._creationTime,{addSuffix:!0})})]})},e._id)}),(0,s.jsx)("div",{ref:j})]})}),(0,s.jsx)("div",{className:"bg-white border-t flex-shrink-0",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto flex gap-2",children:[(0,s.jsx)(l.Textarea,{placeholder:"Type a message...",value:h,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},className:"min-h-[60px] max-h-[120px] resize-none",disabled:f}),(0,s.jsx)(i.Button,{onClick:k,disabled:!h.trim()||f,className:"bg-purple-600 hover:bg-purple-700 h-[60px] px-6",children:(0,s.jsx)(d.Send,{className:"w-5 h-5"})})]})})})]})}e.s(["default",()=>m])}]);