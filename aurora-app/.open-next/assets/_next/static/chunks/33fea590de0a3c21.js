(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let s=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>s],55436)},55935,e=>{"use strict";var s=e.i(43476),a=e.i(932),t=e.i(71645);e.i(50711);var r=e.i(82045),l=e.i(83394),c=e.i(70065),n=e.i(67881),i=e.i(23750),m=e.i(63270),d=e.i(94179),o=e.i(86311),x=e.i(55436),h=e.i(7233),u=e.i(18566),p=e.i(94913);function j(){let e,j,g,N,f,v,y,b,C,w,S,k,A,M,I,U=(0,a.c)(35),[_,B]=(0,t.useState)(null),[T,P]=(0,t.useState)(""),[q,F]=(0,t.useState)(!1),R=(0,u.useRouter)();U[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{(async()=>{try{let e=await fetch("/api/auth/me"),s=await e.json();s.userId&&B(s.userId)}catch(e){console.error("Error getting user:",e)}})()},j=[],U[0]=e,U[1]=j):(e=U[0],j=U[1]),(0,t.useEffect)(e,j),U[2]!==_?(g=_?{userId:_}:"skip",U[2]=_,U[3]=g):g=U[3];let E=(0,r.useQuery)(l.api.directMessages.getConversations,g);U[4]!==T||U[5]!==_?(N=_&&T.length>=2?{query:T,currentUserId:_}:"skip",U[4]=T,U[5]=_,U[6]=N):N=U[6];let K=(0,r.useQuery)(l.api.directMessages.searchUsers,N);return U[7]===Symbol.for("react.memo_cache_sentinel")?(f=(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(o.MessageSquare,{className:"w-6 h-6 text-purple-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Messages"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Connect with the community"})]})]}),U[7]=f):f=U[7],U[8]!==q?(v=()=>F(!q),U[8]=q,U[9]=v):v=U[9],U[10]===Symbol.for("react.memo_cache_sentinel")?(y=(0,s.jsx)(h.Plus,{className:"w-4 h-4 mr-2"}),U[10]=y):y=U[10],U[11]!==v?(b=(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[f,(0,s.jsxs)(n.Button,{onClick:v,className:"bg-purple-600 hover:bg-purple-700",children:[y,"New Message"]})]}),U[11]=v,U[12]=b):b=U[12],U[13]!==R||U[14]!==T||U[15]!==K||U[16]!==q?(C=q&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,s.jsx)(i.Input,{placeholder:"Search users to message...",value:T,onChange:e=>P(e.target.value),className:"pl-9"})]}),K&&K.length>0&&(0,s.jsx)(c.Card,{className:"mt-2",children:(0,s.jsx)(c.CardContent,{className:"p-2",children:K.map(e=>(0,s.jsxs)("button",{onClick:()=>{R.push(`/messages/${e._id}`),F(!1),P("")},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,s.jsxs)(m.Avatar,{children:[(0,s.jsx)(m.AvatarImage,{src:e.profileImage}),(0,s.jsx)(m.AvatarFallback,{children:e.name.charAt(0).toUpperCase()})]}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsx)("p",{className:"font-semibold",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.location||"Aurora Community"})]}),(0,s.jsxs)(d.Badge,{variant:"secondary",children:["Trust: ",e.trustScore]})]},e._id))})})]}),U[13]=R,U[14]=T,U[15]=K,U[16]=q,U[17]=C):C=U[17],U[18]!==b||U[19]!==C?(w=(0,s.jsx)("div",{className:"bg-white border-b",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-4 sm:py-6",children:[b,C]})}),U[18]=b,U[19]=C,U[20]=w):w=U[20],U[21]!==E?(S=!E&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading conversations..."})]}),U[21]=E,U[22]=S):S=U[22],U[23]!==E?(k=E&&0===E.length&&(0,s.jsx)(c.Card,{children:(0,s.jsxs)(c.CardContent,{className:"py-12 text-center",children:[(0,s.jsx)(o.MessageSquare,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No messages yet"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Start a conversation with someone from the community"}),(0,s.jsxs)(n.Button,{onClick:()=>F(!0),children:[(0,s.jsx)(h.Plus,{className:"w-4 h-4 mr-2"}),"Start Messaging"]})]})}),U[23]=E,U[24]=k):k=U[24],U[25]!==E||U[26]!==R?(A=E&&E.length>0&&(0,s.jsx)("div",{className:"space-y-2",children:E.map(e=>(0,s.jsx)(c.Card,{className:"hover-lift cursor-pointer",onClick:()=>R.push(`/messages/${e.partnerId}`),children:(0,s.jsx)(c.CardContent,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsxs)(m.Avatar,{className:"w-12 h-12",children:[(0,s.jsx)(m.AvatarImage,{src:e.partner?.profileImage}),(0,s.jsx)(m.AvatarFallback,{children:e.partner?.name?.charAt(0).toUpperCase()||"U"})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("p",{className:"font-semibold truncate",children:e.partner?.name||"Unknown User"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:(0,p.formatDistanceToNow)(e.lastMessage.timestamp,{addSuffix:!0})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600 truncate",children:[e.lastMessage.isFromMe&&"You: ",e.lastMessage.content]}),e.unreadCount>0&&(0,s.jsx)(d.Badge,{className:"bg-purple-600 ml-2 flex-shrink-0",children:e.unreadCount})]})]})]})})},e.partnerId))}),U[25]=E,U[26]=R,U[27]=A):A=U[27],U[28]!==S||U[29]!==k||U[30]!==A?(M=(0,s.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-6",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[S,k,A]})}),U[28]=S,U[29]=k,U[30]=A,U[31]=M):M=U[31],U[32]!==M||U[33]!==w?(I=(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[w,M]}),U[32]=M,U[33]=w,U[34]=I):I=U[34],I}e.s(["default",()=>j])}]);