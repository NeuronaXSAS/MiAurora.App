module.exports=[24669,a=>{"use strict";let b=(0,a.i(70106).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);a.s(["TrendingUp",()=>b],24669)},53940,a=>{"use strict";let b="offline-routes";function c(a,b,c,d){let e=a*Math.PI/180,f=c*Math.PI/180,g=(c-a)*Math.PI/180,h=(d-b)*Math.PI/180,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(e)*Math.cos(f)*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}async function d(a,c){let d=await new Promise((a,c)=>{let d=indexedDB.open("aurora-routes",1);d.onerror=()=>c(d.error),d.onsuccess=()=>a(d.result),d.onupgradeneeded=a=>{let c=a.target.result;c.objectStoreNames.contains(b)||c.createObjectStore(b,{keyPath:"id",autoIncrement:!0})}}),e=d.transaction([b],"readwrite").objectStore(b);await new Promise((b,d)=>{let f=e.put({routeId:a,coordinates:c,timestamp:Date.now()});f.onsuccess=()=>b(),f.onerror=()=>d(f.error)}),d.close()}class e{watchId=null;state={isTracking:!1,isPaused:!1,coordinates:[],stats:{distance:0,duration:0,pace:0,elevationGain:0},startTime:null,pausedTime:0};lastSampleTime=0;lastSamplePosition=null;onUpdate=null;onError=null;start(a,b){this.state.isTracking||(this.onUpdate=a,this.onError=b||null,this.state.isTracking=!0,this.state.isPaused=!1,this.state.startTime=Date.now(),this.lastSampleTime=Date.now(),"geolocation"in navigator?this.watchId=navigator.geolocation.watchPosition(a=>this.handlePosition(a),a=>this.handleError(a),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):this.handleError({code:0,message:"Geolocation not supported"}))}pause(){this.state.isTracking&&!this.state.isPaused&&(this.state.isPaused=!0,this.notifyUpdate())}resume(){this.state.isTracking&&this.state.isPaused&&(this.state.isPaused=!1,this.state.pausedTime+=Date.now()-(this.lastSampleTime||Date.now()),this.lastSampleTime=Date.now(),this.notifyUpdate())}stop(){return null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.state.isTracking=!1,this.state.isPaused=!1,this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),{...this.state}}getState(){return{...this.state}}handlePosition(a){if(!this.state.isTracking||this.state.isPaused)return;let b={lat:a.coords.latitude,lng:a.coords.longitude,timestamp:a.timestamp,elevation:a.coords.altitude||void 0};this.shouldSample(b)&&(this.state.coordinates.push(b),this.lastSamplePosition=b,this.lastSampleTime=Date.now(),this.updateStats(),this.notifyUpdate(),this.state.coordinates.length%10==0&&this.saveToOfflineStorage())}shouldSample(a){return!!(!this.lastSamplePosition||Date.now()-this.lastSampleTime>=5e3||c(this.lastSamplePosition.lat,this.lastSamplePosition.lng,a.lat,a.lng)>=10)}updateStats(){this.state.stats.distance=function(a){if(a.length<2)return 0;let b=0;for(let d=1;d<a.length;d++)b+=c(a[d-1].lat,a[d-1].lng,a[d].lat,a[d].lng);return b}(this.state.coordinates),this.state.stats.elevationGain=function(a){if(a.length<2)return 0;let b=0;for(let c=1;c<a.length;c++){let d=a[c-1].elevation||0,e=a[c].elevation||0;e>d&&(b+=e-d)}return b}(this.state.coordinates),this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),this.state.stats.distance>0&&this.state.stats.duration>0&&(this.state.stats.pace=this.state.stats.duration/60/(this.state.stats.distance/1e3))}handleError(a){console.error("GPS Error:",a),this.onError&&this.onError(a)}notifyUpdate(){this.onUpdate&&this.onUpdate({...this.state})}async saveToOfflineStorage(){try{await d("current",this.state.coordinates)}catch(a){console.error("Failed to save offline route:",a)}}}function f(a){let b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=a%60;return b>0?`${b}:${c.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`:`${c}:${d.toString().padStart(2,"0")}`}function g(a){return a>=1e3?`${(a/1e3).toFixed(2)} km`:`${Math.round(a)} m`}function h(a){if(!isFinite(a)||0===a)return"--:--";let b=Math.floor(a),c=Math.round((a-b)*60);return`${b}:${c.toString().padStart(2,"0")}`}a.s(["GPSTracker",()=>e,"formatDistance",()=>g,"formatDuration",()=>f,"formatPace",()=>h])},210,a=>{"use strict";let b=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},74566,a=>{"use strict";let b=(0,a.i(70106).default)("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);a.s(["Navigation",()=>b],74566)},63519,a=>{"use strict";let b=(0,a.i(70106).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);a.s(["Phone",()=>b],63519)},51678,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(11241);var d=a.i(96373),e=a.i(1322),f=a.i(40695),g=a.i(3130),h=a.i(210),i=a.i(74566),j=a.i(73570),k=a.i(63519),l=a.i(24987),m=a.i(24669),n=a.i(50944);class o{state;onStateChange;onError;watchId=null;mapboxToken;constructor(a,b,c){this.mapboxToken=a,this.onStateChange=b,this.onError=c,this.state={isNavigating:!1,currentStepIndex:0,steps:[],remainingDistance:0,remainingDuration:0,currentLocation:null,isOffRoute:!1,routeCoordinates:[]}}async startNavigation(a){try{let b=await this.getCurrentPosition(),c={lat:b.coords.latitude,lng:b.coords.longitude},d=await this.getDirections(c,a[0],a[a.length-1]);this.state={isNavigating:!0,currentStepIndex:0,steps:d.steps,remainingDistance:d.distance,remainingDuration:d.duration,currentLocation:c,isOffRoute:!1,routeCoordinates:d.coordinates},this.startPositionTracking(),this.onStateChange(this.state)}catch(a){this.onError(a)}}async getDirections(a,b,c){let d=`${a.lng},${a.lat};${b.lng},${b.lat};${c.lng},${c.lat}`,e=`https://api.mapbox.com/directions/v5/mapbox/walking/${d}?steps=true&geometries=geojson&access_token=${this.mapboxToken}`,f=await fetch(e);if(!f.ok)throw Error("Failed to get directions");let g=(await f.json()).routes[0];return{distance:g.distance,duration:g.duration,steps:g.legs.flatMap(a=>a.steps.map(a=>({instruction:a.maneuver.instruction,distance:a.distance,duration:a.duration,maneuver:{type:a.maneuver.type,modifier:a.maneuver.modifier,location:a.maneuver.location}}))),coordinates:g.geometry.coordinates.map(([a,b])=>({lat:b,lng:a}))}}startPositionTracking(){navigator.geolocation?this.watchId=navigator.geolocation.watchPosition(a=>{let b={lat:a.coords.latitude,lng:a.coords.longitude};this.updateNavigation(b)},a=>{this.onError(Error(`Location error: ${a.message}`))},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):this.onError(Error("Geolocation not supported"))}updateNavigation(a){this.state.currentLocation=a;let b=this.state.steps[this.state.currentStepIndex];b&&20>this.calculateDistance(a.lat,a.lng,b.maneuver.location[1],b.maneuver.location[0])&&this.state.currentStepIndex<this.state.steps.length-1&&this.state.currentStepIndex++;let c=this.getDistanceToRoute(a);this.state.isOffRoute=c>50,this.updateRemainingStats(),this.onStateChange(this.state)}getDistanceToRoute(a){let b=1/0;for(let c of this.state.routeCoordinates)b=Math.min(b,this.calculateDistance(a.lat,a.lng,c.lat,c.lng));return b}updateRemainingStats(){let a=0,b=0;for(let c=this.state.currentStepIndex;c<this.state.steps.length;c++)a+=this.state.steps[c].distance,b+=this.state.steps[c].duration;this.state.remainingDistance=a,this.state.remainingDuration=b}calculateDistance(a,b,c,d){let e=a*Math.PI/180,f=c*Math.PI/180,g=(c-a)*Math.PI/180,h=(d-b)*Math.PI/180,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(e)*Math.cos(f)*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}getCurrentPosition(){return new Promise((a,b)=>{navigator.geolocation.getCurrentPosition(a,b,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})}stop(){null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.state.isNavigating=!1,this.onStateChange(this.state)}getState(){return this.state}async recalculateRoute(){if(this.state.currentLocation)try{let a=Math.min(this.state.currentStepIndex+5,this.state.routeCoordinates.length-1),b=this.state.routeCoordinates[a],c=this.state.routeCoordinates[this.state.routeCoordinates.length-1],d=await this.getDirections(this.state.currentLocation,b,c);this.state.steps=d.steps,this.state.currentStepIndex=0,this.state.routeCoordinates=d.coordinates,this.state.isOffRoute=!1,this.onStateChange(this.state)}catch(a){this.onError(a)}}}var p=a.i(53940);a.i(95258);var q=a.i(33176),r=a.i(31589);function s(){let a=(0,n.useParams)().routeId,[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),y=(0,c.useRef)(null),z=(0,n.useRouter)(),A=(0,d.useQuery)(e.api.routes.getRoute,a?{routeId:a}:"skip");(0,c.useEffect)(()=>{if(!A||y.current)return;let a=new o("pk.eyJ1IjoibWFsdW5hbyIsImEiOiJjbGNnZTBrd2EyYmRjM29uMndzZDZ2cWRxIn0.7ffmNPdwDu1nU-PkgFgEsw",a=>t(a),a=>v(a.message));return y.current=a,a.startNavigation(A.coordinates),()=>{a.stop()}},[A]);let B=()=>{y.current?.recalculateRoute()};if(!A)return(0,b.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center text-white",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{children:"Loading route..."})]})});let C=s?.steps[s.currentStepIndex],D=s?.steps[s.currentStepIndex+1];return(0,b.jsxs)("div",{className:"h-screen flex flex-col bg-gray-900",children:[(0,b.jsx)("div",{role:"status","aria-live":"assertive","aria-atomic":"true",className:"sr-only",children:C?.instruction}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[s?.currentLocation&&(0,b.jsxs)(q.default,{mapboxAccessToken:"pk.eyJ1IjoibWFsdW5hbyIsImEiOiJjbGNnZTBrd2EyYmRjM29uMndzZDZ2cWRxIn0.7ffmNPdwDu1nU-PkgFgEsw",initialViewState:{longitude:s.currentLocation.lng,latitude:s.currentLocation.lat,zoom:16},style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",children:[(0,b.jsx)(r.Marker,{longitude:s.currentLocation.lng,latitude:s.currentLocation.lat,children:(0,b.jsx)("div",{className:"w-6 h-6 bg-blue-500 rounded-full border-4 border-white shadow-lg animate-pulse"})}),s.routeCoordinates.length>0&&(0,b.jsx)(r.Source,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:s.routeCoordinates.map(a=>[a.lng,a.lat])}},children:(0,b.jsx)(r.Layer,{id:"route",type:"line",paint:{"line-color":s.isOffRoute?"#ef4444":"#8b5cf6","line-width":6}})}),C&&(0,b.jsx)(r.Marker,{longitude:C.maneuver.location[0],latitude:C.maneuver.location[1],children:(0,b.jsx)("div",{className:"w-8 h-8 bg-purple-600 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:(0,b.jsx)(i.Navigation,{className:"w-4 h-4 text-white"})})})]}),s?.isOffRoute&&(0,b.jsx)("div",{className:"absolute top-4 left-4 right-4 bg-red-500 text-white rounded-lg p-4 shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(j.AlertTriangle,{className:"w-6 h-6"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold",children:"You're off route"}),(0,b.jsx)("p",{className:"text-sm",children:"Tap to recalculate"})]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:B,className:"bg-white text-red-600",children:"Recalculate"})]})}),C&&!s?.isOffRoute&&(0,b.jsx)("div",{className:"absolute top-4 left-4 right-4 bg-white rounded-lg p-4 shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(i.Navigation,{className:"w-6 h-6 text-purple-600"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["In ",(0,p.formatDistance)(C.distance)]}),(0,b.jsx)("p",{className:"text-lg font-semibold",children:C.instruction}),D&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Then ",D.instruction.toLowerCase()]})]})]})}),s&&(0,b.jsx)("div",{className:"absolute bottom-24 left-4 right-4 bg-white rounded-lg p-3 shadow-lg",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Distance"}),(0,b.jsx)("p",{className:"text-lg font-bold",children:(0,p.formatDistance)(s.remainingDistance)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"ETA"}),(0,b.jsx)("p",{className:"text-lg font-bold",children:(0,p.formatDuration)(s.remainingDuration)})]})]})}),(0,b.jsx)("button",{onClick:()=>{x(!0)},className:"absolute bottom-24 right-4 w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg flex items-center justify-center transition-colors","aria-label":"I feel unsafe - Get help",children:(0,b.jsx)(j.AlertTriangle,{className:"w-8 h-8"})}),u&&(0,b.jsx)("div",{className:"absolute top-4 left-4 right-4 bg-red-500 text-white rounded-lg p-4 shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.AlertTriangle,{className:"w-5 h-5"}),(0,b.jsx)("p",{children:u})]})})]}),(0,b.jsx)("div",{className:"bg-white border-t p-4",children:(0,b.jsx)("div",{className:"max-w-md mx-auto flex gap-3",children:(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>{y.current?.stop(),z.push("/routes")},className:"flex-1 min-h-[56px]","aria-label":"Stop navigation",children:[(0,b.jsx)(h.ArrowLeft,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Stop"]})})}),w&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:(0,b.jsx)(g.Card,{className:"max-w-md w-full",children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsxs)("div",{className:"text-center mb-6",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(j.AlertTriangle,{className:"w-8 h-8 text-red-600"})}),(0,b.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Need Help?"}),(0,b.jsx)("p",{className:"text-gray-600",children:"We're here to help you stay safe"})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)(f.Button,{variant:"destructive",size:"lg",className:"w-full",onClick:()=>window.location.href="tel:911",children:[(0,b.jsx)(k.Phone,{className:"w-5 h-5 mr-2"}),"Call Emergency (911)"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"lg",className:"w-full",onClick:()=>{alert("Finding nearest safe spaces...")},children:[(0,b.jsx)(l.MapPin,{className:"w-5 h-5 mr-2"}),"Find Nearest Safe Space"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"lg",className:"w-full",onClick:()=>{B(),x(!1)},children:[(0,b.jsx)(m.TrendingUp,{className:"w-5 h-5 mr-2"}),"Find Alternative Route"]}),(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>x(!1),className:"w-full",children:"Cancel"})]})]})})})]})}a.s(["default",()=>s],51678)},2880,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_mapbox-gl_dist_mapbox-gl_32a5203b.js"].map(b=>a.l(b))).then(()=>b(53311)))}];

//# sourceMappingURL=_53dd2d46._.js.map