module.exports=[24669,a=>{"use strict";let b=(0,a.i(70106).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);a.s(["TrendingUp",()=>b],24669)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Clock",()=>b],41710)},48124,a=>{"use strict";let b=(0,a.i(70106).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);a.s(["Square",()=>b],48124)},90705,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(11241);var d=a.i(96373),e=a.i(1322);let f=null;async function g(){if(!("wakeLock"in navigator))return console.warn("Wake Lock API not supported"),!1;try{return(f=await navigator.wakeLock.request("screen")).addEventListener("release",()=>{console.log("Wake Lock released")}),console.log("Wake Lock acquired"),!0}catch(a){return console.error("Wake Lock request failed:",a),!1}}async function h(){if(f)try{await f.release(),f=null,console.log("Wake Lock manually released")}catch(a){console.error("Wake Lock release failed:",a)}}"undefined"!=typeof document&&(document.addEventListener("visibilitychange",async()=>{null!==f&&"visible"===document.visibilityState&&(console.log("Page visible - re-acquiring wake lock"),await g())}),window.addEventListener("focus",async()=>{null!==f&&(console.log("Window focused - ensuring wake lock"),await g())}));let i=new class{watchId=null;state={isTracking:!1,coordinates:[],distance:0,duration:0,startTime:null};coordinateCallbacks=[];statsCallbacks=[];statsInterval=null;async startTracking(){return this.state.isTracking?(console.warn("Tracking already active"),!1):(await g()||console.warn("Wake lock not acquired, tracking may be interrupted"),navigator.geolocation)?(this.watchId=navigator.geolocation.watchPosition(a=>this.handlePosition(a),a=>this.handleError(a),{enableHighAccuracy:!0,maximumAge:0,timeout:5e3}),this.state.isTracking=!0,this.state.startTime=Date.now(),this.state.coordinates=[],this.state.distance=0,this.state.duration=0,this.statsInterval=setInterval(()=>{this.state.startTime&&(this.state.duration=Math.floor((Date.now()-this.state.startTime)/1e3),this.notifyStatsCallbacks())},1e3),console.log("Real-time GPS tracking started"),!0):(console.error("Geolocation not supported"),!1)}async stopTracking(){return this.state.isTracking?(null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=null),await h(),this.state.isTracking=!1,console.log("Real-time GPS tracking stopped"),{...this.state}):(console.warn("Tracking not active"),this.state)}handlePosition(a){let b={lat:a.coords.latitude,lng:a.coords.longitude,timestamp:Date.now(),accuracy:a.coords.accuracy};if(this.state.coordinates.length>0){let a=this.state.coordinates[this.state.coordinates.length-1],c=this.calculateDistance(a.lat,a.lng,b.lat,b.lng);this.state.distance+=c}this.state.coordinates.push(b),this.notifyCoordinateCallbacks(b)}handleError(a){switch(console.error("GPS error:",a.message),a.code){case a.PERMISSION_DENIED:console.error("User denied geolocation permission");break;case a.POSITION_UNAVAILABLE:console.error("Location information unavailable");break;case a.TIMEOUT:console.error("Location request timed out")}}calculateDistance(a,b,c,d){let e=a*Math.PI/180,f=c*Math.PI/180,g=(c-a)*Math.PI/180,h=(d-b)*Math.PI/180,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(e)*Math.cos(f)*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}onCoordinate(a){return this.coordinateCallbacks.push(a),()=>{this.coordinateCallbacks=this.coordinateCallbacks.filter(b=>b!==a)}}onStats(a){return this.statsCallbacks.push(a),()=>{this.statsCallbacks=this.statsCallbacks.filter(b=>b!==a)}}notifyCoordinateCallbacks(a){this.coordinateCallbacks.forEach(b=>{try{b(a)}catch(a){console.error("Error in coordinate callback:",a)}})}notifyStatsCallbacks(){let a={distance:this.state.distance,duration:this.state.duration};this.statsCallbacks.forEach(b=>{try{b(a)}catch(a){console.error("Error in stats callback:",a)}})}getState(){return{...this.state}}isWakeLockActive(){return null!==f&&!f.released}};var j=a.i(40695),k=a.i(3130),l=a.i(25015),m=a.i(48124),n=a.i(24987),o=a.i(41710),p=a.i(24669);let q=(0,a.i(70106).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function r(){let[a,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(!1),[r,s]=(0,c.useState)(0),[t,u]=(0,c.useState)(0),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(0),[F,G]=(0,c.useState)(!1),H=(0,d.useMutation)(e.api.routes.startRoute),I=(0,d.useMutation)(e.api.routes.saveCoordinates),J=(0,d.useMutation)(e.api.routes.completeRoute);(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/auth/me"),b=await a.json();b.userId&&y(b.userId)}catch(a){console.error("Error getting user:",a)}})()},[]),(0,c.useEffect)(()=>{let a,b=[],c=i.onCoordinate(async a=>{w(b=>[...b,a]),b.push(a)});z&&(a=setInterval(async()=>{if(b.length>0&&z)try{await I({routeId:z,coordinates:b.map(a=>({lat:a.lat,lng:a.lng,timestamp:a.timestamp}))}),b=[]}catch(a){console.error("Error streaming coordinates:",a)}},5e3));let d=i.onStats(a=>{s(a.distance),u(a.duration)});return()=>{c(),d(),a&&clearInterval(a)}},[z,I]);let K=async()=>{if(!x)return void alert("Please log in to track routes");try{if(!await i.startTracking())return void alert("Failed to start GPS tracking. Please check permissions.");let a=await H({userId:x,routeType:"walking"});A(a.routeId),f(!0),C(i.isWakeLockActive()),w([]),s(0),u(0),setTimeout(()=>{h(!0)},3e3)}catch(a){console.error("Error starting route:",a),alert("Failed to start tracking: "+a.message)}},L=a=>{if("touches"in a){let b=a.touches[0],c=a.target.closest(".slide-container");if(!c)return;let d=c.getBoundingClientRect(),e=Math.max(0,Math.min(b.clientX-d.left,d.width-60));E(e),e>.8*d.width&&N()}},M=()=>{G(!1),D<200&&E(0)},N=async()=>{if(z&&x)try{let a=await i.stopTracking(),b=v[0],c=v[v.length-1];await J({routeId:z,userId:x,distance:a.distance,duration:a.duration,elevationGain:0,rating:3,tags:[],sharingLevel:"public",startLocation:b?{name:"Start",lat:b.lat,lng:b.lng}:{name:"Unknown",lat:0,lng:0},endLocation:c?{name:"End",lat:c.lat,lng:c.lng}:{name:"Unknown",lat:0,lng:0}}),f(!1),h(!1),C(!1),A(null),alert("Route saved successfully!")}catch(a){console.error("Error stopping route:",a),alert("Failed to save route: "+a.message)}},O=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`},P=a=>(a/1e3).toFixed(2);return g&&a?(0,b.jsxs)("div",{className:"fixed inset-0 bg-black flex flex-col items-center justify-center",children:[(0,b.jsxs)("div",{className:"text-center space-y-8",children:[(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-red-600 rounded-full animate-pulse"}),(0,b.jsx)("div",{className:"absolute inset-0 w-4 h-4 bg-red-600 rounded-full animate-ping opacity-75"})]})}),(0,b.jsx)("div",{className:"text-gray-700 text-4xl font-mono font-light",children:O(t)}),(0,b.jsxs)("div",{className:"text-gray-800 text-xl font-light",children:[P(r)," km"]}),(0,b.jsxs)("div",{className:"text-gray-800 text-sm",children:[v.length," points"]})]}),(0,b.jsxs)("div",{className:"absolute bottom-8 left-4 right-4",children:[(0,b.jsx)("button",{onClick:()=>{confirm("Trigger emergency alert?")&&alert("Emergency services notified")},className:"w-full mb-4 py-3 bg-red-900 text-red-200 rounded-lg text-sm font-medium",children:"SOS / Emergency"}),(0,b.jsxs)("div",{className:"slide-container relative bg-gray-900 rounded-full h-16 overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute inset-y-0 left-0 bg-red-900 transition-all",style:{width:`${D/250*100}%`}}),(0,b.jsx)("div",{className:"absolute top-2 left-2 w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center cursor-pointer touch-none",style:{transform:`translateX(${D}px)`},onTouchStart:()=>G(!0),onTouchMove:L,onTouchEnd:M,onMouseDown:()=>G(!0),onMouseMove:a=>F&&L(a),onMouseUp:M,children:(0,b.jsx)(m.Square,{className:"w-6 h-6 text-gray-400"})}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,b.jsx)("span",{className:"text-gray-600 text-sm font-medium",children:"Slide to finish â†’"})})]}),(0,b.jsx)("button",{onClick:()=>h(!1),className:"w-full mt-3 py-2 text-gray-700 text-xs",children:"Show interface"})]})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-purple-50 to-white p-4",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Track Your Route"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Record your journey with real-time GPS tracking"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[(0,b.jsxs)(k.Card,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(p.TrendingUp,{className:"w-4 h-4 text-purple-600"}),(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Distance"})]}),(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[P(r)," km"]})]}),(0,b.jsxs)(k.Card,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(o.Clock,{className:"w-4 h-4 text-purple-600"}),(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"Time"})]}),(0,b.jsx)("div",{className:"text-2xl font-bold",children:O(t)})]})]}),a&&(0,b.jsx)(k.Card,{className:"p-3 mb-6 bg-green-50 border-green-200",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q,{className:`w-4 h-4 ${B?"text-green-600":"text-yellow-600"}`}),(0,b.jsx)("span",{className:"text-sm font-medium",children:B?"Screen lock active - tracking in background":"Screen lock unavailable"})]})}),(0,b.jsxs)(k.Card,{className:"p-4 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.MapPin,{className:"w-5 h-5 text-purple-600"}),(0,b.jsx)("span",{className:"font-medium",children:"GPS Points"})]}),(0,b.jsx)("span",{className:"text-2xl font-bold text-purple-600",children:v.length})]}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-2",children:"Streaming to cloud in real-time"})]}),(0,b.jsx)("div",{className:"fixed bottom-24 left-0 right-0 px-4 space-y-3",children:a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(j.Button,{onClick:()=>h(!0),className:"w-full h-12 bg-gray-900 hover:bg-black text-white",children:[(0,b.jsx)(q,{className:"w-5 h-5 mr-2"}),"Enable Stealth Mode"]}),(0,b.jsxs)(j.Button,{onClick:N,variant:"destructive",className:"w-full h-16 text-lg",children:[(0,b.jsx)(m.Square,{className:"w-6 h-6 mr-2"}),"Stop & Save"]})]}):(0,b.jsxs)(j.Button,{onClick:K,className:"w-full h-16 text-lg bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",disabled:!x,children:[(0,b.jsx)(l.Play,{className:"w-6 h-6 mr-2"}),"Start Tracking"]})}),!a&&(0,b.jsxs)("div",{className:"mt-8 text-center text-sm text-gray-600 space-y-2",children:[(0,b.jsx)("p",{className:"font-medium",children:"ðŸŒ™ Stealth Mode Available"}),(0,b.jsx)("p",{children:"Track routes with black screen (OLED battery saver)"}),(0,b.jsx)("p",{className:"text-xs",children:"GPS stays active â€¢ Slide to finish â€¢ SOS button included"})]})]})}a.s(["default",()=>r],90705)}];

//# sourceMappingURL=_312a82fe._.js.map