module.exports=[35999,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(13513),f=a.i(33508),g=a.i(70106);let h=(0,g.default)("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);var i=a.i(33441),j=a.i(81560),k=a.i(40695);function l({onRecordingComplete:a,onCancel:d,maxDuration:g=60}){let[l,m]=(0,c.useState)("idle"),[n,o]=(0,c.useState)(0),[p,q]=(0,c.useState)("user"),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),v=(0,c.useRef)(null),w=(0,c.useRef)(null),x=(0,c.useRef)(null),y=(0,c.useRef)(null),z=(0,c.useRef)([]),A=(0,c.useRef)(null);(0,c.useEffect)(()=>(B(),()=>{C()}),[p]);let B=async()=>{try{let a=await navigator.mediaDevices.getUserMedia({video:{facingMode:p,width:{ideal:1080},height:{ideal:1920}},audio:!0});x.current=a,v.current&&(v.current.srcObject=a),s(null)}catch(a){console.error("Failed to access camera:",a),s("Failed to access camera. Please grant camera permissions.")}},C=()=>{x.current&&(x.current.getTracks().forEach(a=>a.stop()),x.current=null)},D=()=>{y.current&&"recording"===l&&(y.current.stop(),C(),A.current&&(clearInterval(A.current),A.current=null))},E=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`};return(0,b.jsxs)("div",{className:"fixed inset-0 z-50 bg-black",children:["preview"!==l&&(0,b.jsx)("video",{ref:v,autoPlay:!0,playsInline:!0,muted:!0,className:`absolute inset-0 w-full h-full object-cover ${"user"===p?"scale-x-[-1]":""}`}),"preview"===l&&(0,b.jsx)("video",{ref:w,autoPlay:!0,loop:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),r&&(0,b.jsx)("div",{className:"absolute top-20 left-0 right-0 mx-4 p-4 bg-red-500/90 text-white rounded-lg text-center",children:r}),(0,b.jsx)("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/60 to-transparent",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",onClick:d,className:"text-white hover:bg-white/20",children:(0,b.jsx)(f.X,{className:"h-6 w-6"})}),"recording"===l&&(0,b.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-500 rounded-full",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),(0,b.jsxs)("span",{className:"text-white font-semibold",children:[E(n)," / ",E(g)]})]}),"idle"===l&&(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",onClick:()=>{q(a=>"user"===a?"environment":"user")},className:"text-white hover:bg-white/20",children:(0,b.jsx)(h,{className:"h-6 w-6"})})]})}),(0,b.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black/60 to-transparent",children:["idle"===l&&(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)("button",{onClick:()=>{if(x.current)try{let a=new MediaRecorder(x.current,{mimeType:"video/webm;codecs=vp9"});y.current=a,z.current=[],a.ondataavailable=a=>{a.data.size>0&&z.current.push(a.data)},a.onstop=()=>{let a=new Blob(z.current,{type:"video/webm"});u(a),w.current&&(w.current.src=URL.createObjectURL(a)),m("preview")},a.start(),m("recording"),o(0),A.current=setInterval(()=>{o(a=>{let b=a+1;return b>=g&&D(),b})},1e3)}catch(a){console.error("Failed to start recording:",a),s("Failed to start recording")}},className:"w-20 h-20 rounded-full bg-red-500 border-4 border-white shadow-lg hover:scale-110 transition-transform active:scale-95 flex items-center justify-center",children:(0,b.jsx)(e.Camera,{className:"h-8 w-8 text-white"})})}),"recording"===l&&(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)("button",{onClick:D,className:"w-20 h-20 rounded-lg bg-red-500 border-4 border-white shadow-lg hover:scale-110 transition-transform active:scale-95"})}),"preview"===l&&(0,b.jsxs)("div",{className:"flex justify-center gap-8",children:[(0,b.jsx)("button",{onClick:()=>{u(null),m("idle"),o(0),B()},className:"w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm border-2 border-white shadow-lg hover:scale-110 transition-transform active:scale-95 flex items-center justify-center",children:(0,b.jsx)(j.Trash2,{className:"h-6 w-6 text-white"})}),(0,b.jsx)("button",{onClick:()=>{t&&a(t)},className:"w-20 h-20 rounded-full bg-purple-500 border-4 border-white shadow-lg hover:scale-110 transition-transform active:scale-95 flex items-center justify-center",children:(0,b.jsx)(i.Check,{className:"h-8 w-8 text-white"})})]})]}),"recording"===l&&(0,b.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-white/20",children:(0,b.jsx)("div",{className:"h-full bg-red-500 transition-all duration-1000",style:{width:`${n/g*100}%`}})})]})}let m=(0,g.default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var n=a.i(96221),o=a.i(24987),p=a.i(46893),q=a.i(46143),r=a.i(17171),s=a.i(2150);a.i(11241);var t=a.i(96373),u=a.i(1322);let v=[{id:"safe",label:"Safe Area",emoji:"âœ…"},{id:"harassment",label:"Harassment",emoji:"âš ï¸"},{id:"dark",label:"Dark/Poorly Lit",emoji:"ðŸŒ™"},{id:"inspiring",label:"Inspiring",emoji:"âœ¨"},{id:"crowded",label:"Crowded",emoji:"ðŸ‘¥"},{id:"isolated",label:"Isolated",emoji:"ðŸš¶"}];function w({videoBlob:a,videoPreviewUrl:d,onSuccess:e,onCancel:f}){let[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)([]),[l,w]=(0,c.useState)(!1),{upload:x,progress:y,isUploading:z,error:A}=function(){let[a,b]=(0,c.useState)(null),[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(null),h=(0,t.useQuery)(u.api.reels.generateUploadCredentials,{userId:"temp"}),i=(0,t.useMutation)(u.api.reels.createReel),j=(0,t.useAction)(u.api.actions.analyzeReel.analyzeReelContent);return{upload:async(a,c)=>{e(!0),g(null),b({loaded:0,total:a.size,percentage:0});try{var d,f;if(!a.type.startsWith("video/"))throw Error("File must be a video");if(a.size>0x6400000)throw Error("Video must be less than 100MB");let g=await (d=a,new Promise((a,b)=>{let c=document.createElement("video");c.preload="metadata",c.onloadedmetadata=()=>{window.URL.revokeObjectURL(c.src),a(c.duration)},c.onerror=()=>{b(Error("Failed to load video metadata"))},c.src=URL.createObjectURL(d)}));if(g<15||g>90)throw Error("Video must be between 15 and 90 seconds");if(!h||!h.success)throw Error("Cloudinary not configured");let{credentials:k}=h,l=new FormData;l.append("file",a),l.append("upload_preset","aurora_reels"),l.append("folder","aurora/reels");let m=new XMLHttpRequest;m.upload.addEventListener("progress",a=>{a.lengthComputable&&b({loaded:a.loaded,total:a.total,percentage:Math.round(a.loaded/a.total*100)})});let n=new Promise((a,b)=>{m.addEventListener("load",()=>{200===m.status?a(JSON.parse(m.responseText)):b(Error(`Upload failed: ${m.statusText}`))}),m.addEventListener("error",()=>{b(Error("Upload failed"))}),m.open("POST",k.uploadUrl),m.send(l)}),o=await n,p=o.secure_url,q=o.secure_url.replace("/upload/","/upload/w_400,h_400,c_fill,g_center,so_auto/").replace(/\.[^.]+$/,".jpg"),r=await (f=a,new Promise((a,b)=>{let c=document.createElement("video");c.preload="metadata",c.onloadedmetadata=()=>{window.URL.revokeObjectURL(c.src),a({width:c.videoWidth,height:c.videoHeight})},c.onerror=()=>{b(Error("Failed to load video metadata"))},c.src=URL.createObjectURL(f)})),s=await i({authorId:"temp",provider:"cloudinary",externalId:o.public_id,videoUrl:p,thumbnailUrl:q,duration:g,metadata:{width:r.width,height:r.height,format:o.format,sizeBytes:o.bytes,transformations:{bitRate:o.bit_rate,frameRate:o.frame_rate}},caption:c.caption,hashtags:c.hashtags,location:c.location,isAnonymous:c.isAnonymous});return e(!1),b(null),s.reelId&&j({reelId:s.reelId}).catch(a=>{console.error("AI analysis failed:",a)}),{success:!0,reelId:s.reelId}}catch(c){let a=c instanceof Error?c.message:"Upload failed";return g(a),e(!1),b(null),{success:!1,error:a}}},progress:a,isUploading:d,error:f,reset:()=>{b(null),e(!1),g(null)}}}(),B=async()=>{let b=new File([a],"reel.webm",{type:"video/webm"}),c=g.match(/#\w+/g)?.map(a=>a.slice(1))||[];(await x(b,{caption:g,hashtags:c,isAnonymous:l,safetyTags:i})).success&&e()};return(0,b.jsxs)("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[(0,b.jsxs)("div",{className:"relative w-full h-64 bg-gray-900",children:[(0,b.jsx)("video",{src:d,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/60"})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto bg-gray-950 p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{htmlFor:"caption",className:"text-white text-lg",children:"Caption"}),(0,b.jsx)(p.Textarea,{id:"caption",placeholder:"Share your experience... Use #hashtags",value:g,onChange:a=>h(a.target.value),maxLength:500,rows:4,className:"bg-gray-900 border-gray-800 text-white placeholder:text-gray-500 resize-none"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 text-right",children:[g.length,"/500"]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(r.Label,{className:"text-white text-lg",children:"Safety Tags"}),(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"Help other women by tagging the safety aspects of this location"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-3",children:v.map(a=>(0,b.jsxs)("button",{onClick:()=>{var b;return b=a.id,void j(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:`flex items-center gap-2 p-3 rounded-lg border-2 transition-all ${i.includes(a.id)?"border-purple-500 bg-purple-500/20":"border-gray-800 bg-gray-900 hover:border-gray-700"}`,children:[(0,b.jsx)("span",{className:"text-2xl",children:a.emoji}),(0,b.jsx)("span",{className:"text-sm text-white font-medium",children:a.label})]},a.id))})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-3 p-4 bg-gray-900 rounded-lg",children:[(0,b.jsx)(q.Checkbox,{id:"anonymous",checked:l,onCheckedChange:a=>w(a),className:"border-gray-700"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(r.Label,{htmlFor:"anonymous",className:"text-white font-medium cursor-pointer",children:"Post anonymously"}),(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"Your name won't be shown, but you'll still earn credits"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-gray-900 rounded-lg opacity-50",children:[(0,b.jsx)(o.MapPin,{className:"h-5 w-5 text-gray-500"}),(0,b.jsx)("span",{className:"text-gray-500 text-sm",children:"Add location (Coming soon)"})]}),A&&(0,b.jsx)("div",{className:"p-4 bg-red-500/20 border border-red-500 rounded-lg",children:(0,b.jsx)("p",{className:"text-red-400 text-sm",children:A})}),z&&y&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Uploading..."}),(0,b.jsxs)("span",{className:"text-purple-400 font-semibold",children:[y.percentage,"%"]})]}),(0,b.jsx)(s.Progress,{value:y.percentage,className:"h-2"})]})]}),(0,b.jsxs)("div",{className:"p-6 bg-gray-950 border-t border-gray-900 space-y-3",children:[(0,b.jsx)(k.Button,{onClick:B,disabled:z||0===g.trim().length,className:"w-full h-14 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold text-lg rounded-xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:z?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:["Post Reel",(0,b.jsx)(m,{className:"ml-2 h-5 w-5"})]})}),(0,b.jsx)(k.Button,{onClick:f,disabled:z,variant:"ghost",className:"w-full text-gray-400 hover:text-white hover:bg-gray-900",children:"Cancel"})]})]})}function x(){let a=(0,d.useRouter)(),[e,f]=(0,c.useState)("recording"),[g,h]=(0,c.useState)(null);return(0,b.jsxs)(b.Fragment,{children:["recording"===e&&(0,b.jsx)(l,{onRecordingComplete:a=>{let b=URL.createObjectURL(a);h({blob:a,previewUrl:b}),f("form")},onCancel:()=>{g?.previewUrl&&URL.revokeObjectURL(g.previewUrl),a.back()},maxDuration:60}),"form"===e&&g&&(0,b.jsx)(w,{videoBlob:g.blob,videoPreviewUrl:g.previewUrl,onSuccess:()=>{f("success"),setTimeout(()=>{a.push("/reels")},2e3)},onCancel:()=>{g?.previewUrl&&URL.revokeObjectURL(g.previewUrl),h(null),f("recording")}}),"success"===e&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 bg-black flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center space-y-4 animate-in fade-in zoom-in duration-500",children:[(0,b.jsx)("div",{className:"w-24 h-24 mx-auto rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-12 h-12 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Reel Posted!"}),(0,b.jsx)("p",{className:"text-gray-400",children:"You earned 20 credits ðŸŽ‰"})]})})]})}a.s(["default",()=>x],35999)}];

//# sourceMappingURL=app_%28authenticated%29_reels_create_page_tsx_7b80fec8._.js.map