module.exports=[26123,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(11241);var d=a.i(96373),e=a.i(1322),f=a.i(40695),g=a.i(5522),h=a.i(46893),i=a.i(3130),j=a.i(21374),k=a.i(43108),l=a.i(44494),m=a.i(92319),n=a.i(8406),o=a.i(50944),p=a.i(53940);let q=(0,a.i(70106).default)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);var r=a.i(48124),s=a.i(25015),t=a.i(8549),u=a.i(81560),v=a.i(73320);function w({onRecordingComplete:a,onRecordingDelete:d,maxDuration:e=180}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(0),[o,p]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),y=(0,c.useRef)(null),z=(0,c.useRef)([]),A=(0,c.useRef)(null),B=(0,c.useRef)(null);(0,c.useEffect)(()=>()=>{B.current&&clearInterval(B.current),o&&URL.revokeObjectURL(o)},[o]);let C=async()=>{try{let a=await navigator.mediaDevices.getUserMedia({audio:!0}),b=new MediaRecorder(a);y.current=b,z.current=[],b.ondataavailable=a=>{a.data.size>0&&z.current.push(a.data)},b.onstop=()=>{let b=new Blob(z.current,{type:"audio/webm"}),c=URL.createObjectURL(b);p(c),x(b),a.getTracks().forEach(a=>a.stop())},b.start(),h(!0),j(!1),B.current=setInterval(()=>{n(a=>{let b=a+1;return b>=e&&D(),b})},1e3)}catch(a){console.error("Error accessing microphone:",a),alert("Could not access microphone. Please check permissions.")}},D=()=>{y.current&&(y.current.stop(),h(!1),j(!1),B.current&&clearInterval(B.current))},E=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`};return(0,b.jsxs)("div",{className:"space-y-4",children:[!o&&!g&&(0,b.jsxs)(f.Button,{type:"button",variant:"outline",onClick:C,className:"w-full",children:[(0,b.jsx)(q,{className:"w-4 h-4 mr-2"}),"Record Voice Note"]}),g&&(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,b.jsx)("span",{className:"font-medium text-red-900",children:i?"Paused":"Recording"})]}),(0,b.jsxs)("span",{className:"text-sm font-mono text-red-900",children:[E(m)," / ",E(e)]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[i?(0,b.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{y.current&&"paused"===y.current.state&&(y.current.resume(),j(!1),B.current=setInterval(()=>{n(a=>{let b=a+1;return b>=e&&D(),b})},1e3))},className:"flex-1",children:[(0,b.jsx)(q,{className:"w-4 h-4 mr-2"}),"Resume"]}):(0,b.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{y.current&&"recording"===y.current.state&&(y.current.pause(),j(!0),B.current&&clearInterval(B.current))},className:"flex-1",children:[(0,b.jsx)(t.Pause,{className:"w-4 h-4 mr-2"}),"Pause"]}),(0,b.jsxs)(f.Button,{type:"button",variant:"destructive",size:"sm",onClick:D,className:"flex-1",children:[(0,b.jsx)(r.Square,{className:"w-4 h-4 mr-2"}),"Stop"]})]})]}),o&&(0,b.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("span",{className:"font-medium text-purple-900",children:"Voice Note"}),(0,b.jsx)("span",{className:"text-sm font-mono text-purple-700",children:E(m)})]}),(0,b.jsx)("audio",{ref:A,src:o,onEnded:()=>l(!1),className:"hidden"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[k?(0,b.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{A.current&&(A.current.pause(),l(!1))},className:"flex-1",children:[(0,b.jsx)(t.Pause,{className:"w-4 h-4 mr-2"}),"Pause"]}):(0,b.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{A.current&&(A.current.play(),l(!0))},className:"flex-1",children:[(0,b.jsx)(s.Play,{className:"w-4 h-4 mr-2"}),"Play"]}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{o&&URL.revokeObjectURL(o),p(null),x(null),n(0),l(!1),d()},children:(0,b.jsx)(u.Trash2,{className:"w-4 h-4"})}),(0,b.jsxs)(f.Button,{type:"button",size:"sm",onClick:()=>{w&&a(w)},className:"flex-1",children:[(0,b.jsx)(v.Upload,{className:"w-4 h-4 mr-2"}),"Use This"]})]})]})]})}let x=["safe","inspiring","challenging","healing","accessible","beautiful","quiet","scenic","well-lit","busy"];function y(){let a=(0,o.useParams)().routeId,[q,r]=(0,c.useState)(null),s=(0,o.useRouter)(),[t,u]=(0,c.useState)(""),[v,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(0),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)("private"),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/auth/me"),b=await a.json();b.userId&&r(b.userId)}catch(a){console.error("Error getting user:",a)}})()},[]);let N=(0,d.useQuery)(e.api.routes.getRoute,a?{routeId:a}:"skip"),O=(0,d.useMutation)(e.api.routes.completeRoute),P=(0,d.useMutation)(e.api.files.generateUploadUrl),Q=async()=>{if(q&&N){if(0===z)return void I("Please select a rating");if(0===v.length)return void I("Please select at least one tag");G(!0),I(null);try{let b;if(J){M(!0);let a=await P(),c=await fetch(a,{method:"POST",headers:{"Content-Type":J.type},body:J}),{storageId:d}=await c.json();b=d,M(!1)}if(!N.coordinates||0===N.coordinates.length)return void I("Route has no GPS data. Please track a route first.");let c=N.coordinates[0],d=N.coordinates[N.coordinates.length-1];if(!c||!d)return void I("Invalid route coordinates");let e=await R(c.lat,c.lng),f=await R(d.lat,d.lng);await O({routeId:a,userId:q,title:t||`${N.routeType.charAt(0).toUpperCase()+N.routeType.slice(1)} Route`,distance:N.distance,duration:N.duration,elevationGain:N.elevationGain,startLocation:{lat:c.lat,lng:c.lng,name:e},endLocation:{lat:d.lat,lng:d.lng,name:f},tags:v,rating:z,journalEntry:B||void 0,voiceNoteStorageId:b,sharingLevel:D}),s.push("/routes")}catch(a){I(a.message||"Failed to save route")}finally{G(!1),M(!1)}}},R=async(a,b)=>{try{let c=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${b},${a}.json?access_token=pk.eyJ1IjoibWFsdW5hbyIsImEiOiJjbGNnZTBrd2EyYmRjM29uMndzZDZ2cWRxIn0.7ffmNPdwDu1nU-PkgFgEsw&limit=1`),d=await c.json();return d.features?.[0]?.place_name||"Unknown location"}catch{return"Unknown location"}};return N?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,b.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-6 sm:py-8",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Complete Your Route"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Add details and share with the community"}),(0,b.jsx)(i.Card,{className:"mb-6",children:(0,b.jsx)(i.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Distance"}),(0,b.jsx)("p",{className:"text-xl font-bold",children:(0,p.formatDistance)(N.distance)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Duration"}),(0,b.jsx)("p",{className:"text-xl font-bold",children:(0,p.formatDuration)(N.duration)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Type"}),(0,b.jsx)("p",{className:"text-xl font-bold capitalize",children:N.routeType})]})]})})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Route Title (Optional)"}),(0,b.jsx)(g.Input,{placeholder:"e.g., Morning run through Central Park",value:t,onChange:a=>u(a.target.value),maxLength:100})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Tags * (Select at least one)"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>{y(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${v.includes(a)?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Overall Experience *"}),(0,b.jsx)("div",{className:"flex gap-2",children:[1,2,3,4,5].map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>A(a),className:"focus:outline-none",children:(0,b.jsx)(j.Star,{className:`w-10 h-10 transition-colors ${a<=z?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200"}`})},a))}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[0===z&&"Rate your experience",1===z&&"Very Poor",2===z&&"Poor",3===z&&"Okay",4===z&&"Good",5===z&&"Excellent"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Journal Entry (Optional)"}),(0,b.jsx)(h.Textarea,{placeholder:"Share your thoughts, feelings, or observations about this route...",value:B,onChange:a=>C(a.target.value),rows:5,maxLength:2e3}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[B.length,"/2000 characters",B.length>200&&" • +5 bonus credits for detailed entry!"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Voice Note (Optional)"}),(0,b.jsx)(w,{onRecordingComplete:a=>{K(a)},onRecordingDelete:()=>{K(null)},maxDuration:180}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Record up to 3 minutes to share your experience"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-3 block",children:"Sharing Preferences"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>E("private"),className:`w-full p-4 rounded-lg border-2 transition-colors text-left ${"private"===D?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(k.Lock,{className:"w-5 h-5 mt-0.5 text-gray-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:"Private"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Only you can see this route"})]})]})}),(0,b.jsx)("button",{type:"button",onClick:()=>E("anonymous"),className:`w-full p-4 rounded-lg border-2 transition-colors text-left ${"anonymous"===D?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(m.UserX,{className:"w-5 h-5 mt-0.5 text-gray-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:"Anonymous • +15 credits"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Share without your name"})]})]})}),(0,b.jsx)("button",{type:"button",onClick:()=>E("public"),className:`w-full p-4 rounded-lg border-2 transition-colors text-left ${"public"===D?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(l.Globe,{className:"w-5 h-5 mt-0.5 text-gray-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:"Public • +15 credits"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Share with your name"})]})]})})]})]}),"private"!==D&&(0,b.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(n.Sparkles,{className:"w-5 h-5 text-purple-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium text-sm text-purple-900",children:["Earn ",B.length>200?"20":"15"," credits for sharing!"]}),(0,b.jsx)("p",{className:"text-xs text-purple-700 mt-1",children:"+ 5 more credits each time someone completes your route"})]})]})}),H&&(0,b.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:H}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>s.push("/routes"),disabled:F,className:"flex-1",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:Q,disabled:F||L,className:"flex-1",children:L?"Uploading voice...":F?"Saving...":"Save Route"})]})]})]})})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsx)("p",{className:"text-gray-600",children:"Loading route..."})})}a.s(["default",()=>y],26123)}];

//# sourceMappingURL=app_%28authenticated%29_routes_complete_%5BrouteId%5D_page_tsx_5c37b82c._.js.map