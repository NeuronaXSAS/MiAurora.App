module.exports=[16801,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(53311);a.i(11241);var e=a.i(96373),f=a.i(1322),g=a.i(40695),h=a.i(5522),i=a.i(54161);let j=(0,a.i(70106).default)("crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);var k=a.i(74566),l=a.i(15618),m=a.i(87532),n=a.i(33508),o=a.i(24987);function p({lifeDimension:a,onMarkerClick:p,onLocationSelect:q,ratingFilter:r}){let s=(0,c.useRef)(null),t=(0,c.useRef)(null),u=(0,c.useRef)([]),v=(0,c.useRef)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)([]),M=(0,e.useQuery)(f.api.posts.getPostsForMap,{lifeDimension:a}),N=M?.filter(a=>!r||!(a.rating<r))||[];(0,c.useEffect)(()=>{if(s.current&&!t.current)return t.current=new d.default.Map({container:s.current,style:"mapbox://styles/malunao/cm84u5ecf000x01qled5j8bvl",center:[-98.5795,39.8283],zoom:4}),t.current.addControl(new d.default.NavigationControl,"top-right"),t.current.addControl(new d.default.FullscreenControl,"top-right"),t.current.on("load",()=>{x(!0),C&&t.current&&(t.current.setCenter(C.center),t.current.setZoom(C.zoom))}),t.current.on("moveend",()=>{t.current&&D({center:t.current.getCenter().toArray(),zoom:t.current.getZoom()})}),t.current.on("click",async a=>{if(!y||!q)return;let{lng:b,lat:c}=a.lngLat;try{let a=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${b},${c}.json?access_token=${d.default.accessToken}`),e=await a.json(),f=e.features[0]?.place_name||`${c.toFixed(4)}, ${b.toFixed(4)}`;t.current&&D({center:t.current.getCenter().toArray(),zoom:t.current.getZoom()}),q({lat:c,lng:b,address:f}),z(!1)}catch(a){console.error("Geocoding error:",a),t.current&&D({center:t.current.getCenter().toArray(),zoom:t.current.getZoom()}),q({lat:c,lng:b,address:`${c.toFixed(4)}, ${b.toFixed(4)}`}),z(!1)}}),()=>{u.current.forEach(a=>a.remove()),u.current=[],v.current&&v.current.remove(),t.current&&(t.current.remove(),t.current=null)}},[y,q]),(0,c.useEffect)(()=>{if(t.current&&w&&N&&(u.current.forEach(a=>a.remove()),u.current=[],N.forEach(a=>{if(!a.location||!t.current)return;let b=a.rating>=4?"#22c55e":a.rating>=3?"#eab308":"#ef4444",c=document.createElement("div");c.className="custom-marker",c.style.width="30px",c.style.height="30px",c.style.borderRadius="50%",c.style.backgroundColor=b,c.style.border="3px solid white",c.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",c.style.cursor="pointer",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.fontSize="14px",c.style.fontWeight="bold",c.style.color="white",c.textContent=a.rating.toString();let e=new d.default.Popup({offset:25}).setHTML(`
        <div style="padding: 8px; min-width: 200px;">
          <h3 style="font-weight: bold; margin-bottom: 4px;">${a.title}</h3>
          <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${a.location.name}</p>
          <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 4px;">
            <span style="font-size: 12px;">Rating: ${a.rating}/5</span>
          </div>
          <div style="font-size: 12px; color: #666;">
            ${a.verificationCount} verification${1!==a.verificationCount?"s":""}
            ${a.isVerified?' • <span style="color: #22c55e;">✓ Verified</span>':""}
          </div>
        </div>
      `),f=new d.default.Marker(c).setLngLat(a.location.coordinates).setPopup(e).addTo(t.current);c.addEventListener("click",()=>{p&&p(a._id)}),u.current.push(f)}),N.length>0&&t.current&&!C)){let a=new d.default.LngLatBounds;N.forEach(b=>{b.location&&a.extend(b.location.coordinates)}),t.current.fitBounds(a,{padding:50,maxZoom:12})}},[N,w,p,C]),(0,c.useEffect)(()=>{if(t.current&&w&&A)if(v.current)v.current.setLngLat([A.lng,A.lat]);else{let a=document.createElement("div");a.className="user-location-marker",a.style.width="20px",a.style.height="20px",a.style.borderRadius="50%",a.style.backgroundColor="#3b82f6",a.style.border="3px solid white",a.style.boxShadow="0 0 10px rgba(59, 130, 246, 0.5)",v.current=new d.default.Marker(a).setLngLat([A.lng,A.lat]).setPopup(new d.default.Popup({offset:25}).setHTML('<div style="padding: 8px;"><strong>Your Location</strong></div>')).addTo(t.current)}},[A,w]);let O=async()=>{if(E.trim()){J(!0);try{let a=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(E)}.json?access_token=${d.default.accessToken}&limit=5`),b=await a.json();H(b.features||[])}catch(a){console.error("Search error:",a)}finally{J(!1)}}};return(0,b.jsxs)("div",{className:"relative w-full h-full",children:[(0,b.jsx)("div",{ref:s,className:`w-full h-full rounded-lg ${y?"cursor-crosshair":""}`}),(0,b.jsxs)("div",{className:"absolute top-4 left-4 right-20 z-10 max-w-md",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Input,{type:"text",placeholder:"Search location...",value:E,onChange:a=>F(a.target.value),onKeyDown:a=>"Enter"===a.key&&O(),className:"bg-white shadow-lg pr-10"}),(0,b.jsx)(g.Button,{onClick:O,size:"icon",className:"absolute right-0 top-0 h-full",variant:"ghost",children:(0,b.jsx)(m.Search,{className:"w-4 h-4"})})]}),G.length>0&&(0,b.jsx)("div",{className:"mt-2 bg-white rounded-lg shadow-lg max-h-60 overflow-y-auto",children:G.map((a,c)=>(0,b.jsxs)("button",{onClick:()=>(a=>{if(!t.current)return;let[b,c]=a.center;t.current.flyTo({center:[b,c],zoom:14,duration:2e3,essential:!0}),F(""),H([]),M&&L(M.filter(a=>{if(!a.location)return!1;let[d,e]=a.location.coordinates;return .1>Math.sqrt(Math.pow(d-b,2)+Math.pow(e-c,2))}))})(a),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b last:border-b-0 flex items-start gap-2",children:[(0,b.jsx)(o.MapPin,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-sm truncate",children:a.text}),(0,b.jsx)("p",{className:"text-xs text-gray-500 truncate",children:a.place_name})]})]},c))})]}),(0,b.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col gap-2 z-10",children:[(0,b.jsx)(g.Button,{onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{let{latitude:b,longitude:c}=a.coords;B({lat:b,lng:c}),t.current&&(t.current.flyTo({center:[c,b],zoom:14,duration:2e3,essential:!0}),M&&L(M.filter(a=>{if(!a.location)return!1;let[d,e]=a.location.coordinates;return .1>Math.sqrt(Math.pow(d-c,2)+Math.pow(e-b,2))})))},a=>{console.error("Error getting location:",a),alert("Unable to get your location. Please enable location services.")}):alert("Geolocation is not supported by your browser")},className:"bg-white text-gray-700 hover:bg-gray-100 shadow-lg",size:"icon",title:"Go to my location",children:(0,b.jsx)(k.Navigation,{className:"w-5 h-5"})}),q&&(0,b.jsx)(g.Button,{onClick:()=>z(!y),className:`shadow-lg ${y?"bg-purple-600 text-white hover:bg-purple-700":"bg-white text-gray-700 hover:bg-gray-100"}`,size:"icon",title:"Click map to select location",children:y?(0,b.jsx)(j,{className:"w-5 h-5"}):(0,b.jsx)(l.Plus,{className:"w-5 h-5"})})]}),y&&(0,b.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-purple-600 text-white px-4 py-2 rounded-lg shadow-lg z-10",children:(0,b.jsx)("p",{className:"text-sm font-medium",children:"Click anywhere on the map to select a location"})}),(0,b.jsxs)("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 z-10",children:[(0,b.jsx)("h4",{className:"font-semibold text-sm mb-2",children:"Safety Rating"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-xs",children:"Safe (4-5)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),(0,b.jsx)("span",{className:"text-xs",children:"Neutral (3)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 rounded-full bg-red-500"}),(0,b.jsx)("span",{className:"text-xs",children:"Unsafe (1-2)"})]})]})]}),K.length>0&&(0,b.jsxs)("div",{className:"absolute bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 z-10 max-w-xs max-h-80 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h4",{className:"font-semibold text-sm",children:["Nearby Locations (",K.length,")"]}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>L([]),children:(0,b.jsx)(n.X,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{className:"space-y-2",children:K.map(a=>(0,b.jsx)("button",{onClick:()=>p&&p(a._id),className:"w-full text-left p-2 hover:bg-gray-50 rounded border",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(i.Badge,{className:`flex-shrink-0 ${a.rating>=4?"bg-green-500":a.rating>=3?"bg-yellow-500":"bg-red-500"}`,children:a.rating}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-xs truncate",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-gray-500 truncate",children:a.location?.name})]})]})},a._id))})]})]})}d.default.accessToken="pk.eyJ1IjoibWFsdW5hbyIsImEiOiJjbGNnZTBrd2EyYmRjM29uMndzZDZ2cWRxIn0.7ffmNPdwDu1nU-PkgFgEsw";var q=a.i(21142),r=a.i(87682);function s(){let[a,d]=(0,c.useState)(void 0),[e,f]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(null);return(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/auth/me"),b=await a.json();b.userId&&k(b.userId)}catch(a){console.error("Error getting user:",a)}})()},[]),(0,b.jsxs)("div",{className:"h-screen flex flex-col bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b",children:(0,b.jsx)("div",{className:"px-4 sm:px-6 py-4",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(o.MapPin,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-600 flex-shrink-0 mt-1"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"Safety Map"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Click + to mark a location"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,b.jsxs)(r.Select,{value:a||"all",onValueChange:a=>d("all"===a?void 0:a),children:[(0,b.jsx)(r.SelectTrigger,{className:"w-full sm:w-[200px]",children:(0,b.jsx)(r.SelectValue,{placeholder:"All Dimensions"})}),(0,b.jsxs)(r.SelectContent,{children:[(0,b.jsx)(r.SelectItem,{value:"all",children:"All Dimensions"}),(0,b.jsx)(r.SelectItem,{value:"professional",children:"Professional"}),(0,b.jsx)(r.SelectItem,{value:"social",children:"Social"}),(0,b.jsx)(r.SelectItem,{value:"daily",children:"Daily Life"}),(0,b.jsx)(r.SelectItem,{value:"travel",children:"Travel"}),(0,b.jsx)(r.SelectItem,{value:"financial",children:"Financial"})]})]}),(0,b.jsxs)(g.Button,{onClick:()=>f(!0),className:"w-full sm:w-auto",children:[(0,b.jsx)(l.Plus,{className:"w-4 h-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Create Post"}),(0,b.jsx)("span",{className:"sm:hidden",children:"New Post"})]})]})]})})}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(p,{lifeDimension:a,onLocationSelect:a=>{i(a),f(!0)}})}),j&&(0,b.jsx)(q.PostCreateDialog,{open:e,onOpenChange:f,userId:j,prefilledLocation:h?.address})]})}a.s(["default",()=>s],16801)}];

//# sourceMappingURL=app_%28authenticated%29_map_page_tsx_d2ffdb47._.js.map