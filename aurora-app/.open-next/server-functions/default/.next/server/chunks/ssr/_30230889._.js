module.exports=[24669,a=>{"use strict";let b=(0,a.i(70106).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);a.s(["TrendingUp",()=>b],24669)},81560,a=>{"use strict";let b=(0,a.i(70106).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);a.s(["Trash2",()=>b],81560)},53940,a=>{"use strict";let b="offline-routes";function c(a,b,c,d){let e=a*Math.PI/180,f=c*Math.PI/180,g=(c-a)*Math.PI/180,h=(d-b)*Math.PI/180,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(e)*Math.cos(f)*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}async function d(a,c){let d=await new Promise((a,c)=>{let d=indexedDB.open("aurora-routes",1);d.onerror=()=>c(d.error),d.onsuccess=()=>a(d.result),d.onupgradeneeded=a=>{let c=a.target.result;c.objectStoreNames.contains(b)||c.createObjectStore(b,{keyPath:"id",autoIncrement:!0})}}),e=d.transaction([b],"readwrite").objectStore(b);await new Promise((b,d)=>{let f=e.put({routeId:a,coordinates:c,timestamp:Date.now()});f.onsuccess=()=>b(),f.onerror=()=>d(f.error)}),d.close()}class e{watchId=null;state={isTracking:!1,isPaused:!1,coordinates:[],stats:{distance:0,duration:0,pace:0,elevationGain:0},startTime:null,pausedTime:0};lastSampleTime=0;lastSamplePosition=null;onUpdate=null;onError=null;start(a,b){this.state.isTracking||(this.onUpdate=a,this.onError=b||null,this.state.isTracking=!0,this.state.isPaused=!1,this.state.startTime=Date.now(),this.lastSampleTime=Date.now(),"geolocation"in navigator?this.watchId=navigator.geolocation.watchPosition(a=>this.handlePosition(a),a=>this.handleError(a),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):this.handleError({code:0,message:"Geolocation not supported"}))}pause(){this.state.isTracking&&!this.state.isPaused&&(this.state.isPaused=!0,this.notifyUpdate())}resume(){this.state.isTracking&&this.state.isPaused&&(this.state.isPaused=!1,this.state.pausedTime+=Date.now()-(this.lastSampleTime||Date.now()),this.lastSampleTime=Date.now(),this.notifyUpdate())}stop(){return null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.state.isTracking=!1,this.state.isPaused=!1,this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),{...this.state}}getState(){return{...this.state}}handlePosition(a){if(!this.state.isTracking||this.state.isPaused)return;let b={lat:a.coords.latitude,lng:a.coords.longitude,timestamp:a.timestamp,elevation:a.coords.altitude||void 0};this.shouldSample(b)&&(this.state.coordinates.push(b),this.lastSamplePosition=b,this.lastSampleTime=Date.now(),this.updateStats(),this.notifyUpdate(),this.state.coordinates.length%10==0&&this.saveToOfflineStorage())}shouldSample(a){return!!(!this.lastSamplePosition||Date.now()-this.lastSampleTime>=5e3||c(this.lastSamplePosition.lat,this.lastSamplePosition.lng,a.lat,a.lng)>=10)}updateStats(){this.state.stats.distance=function(a){if(a.length<2)return 0;let b=0;for(let d=1;d<a.length;d++)b+=c(a[d-1].lat,a[d-1].lng,a[d].lat,a[d].lng);return b}(this.state.coordinates),this.state.stats.elevationGain=function(a){if(a.length<2)return 0;let b=0;for(let c=1;c<a.length;c++){let d=a[c-1].elevation||0,e=a[c].elevation||0;e>d&&(b+=e-d)}return b}(this.state.coordinates),this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),this.state.stats.distance>0&&this.state.stats.duration>0&&(this.state.stats.pace=this.state.stats.duration/60/(this.state.stats.distance/1e3))}handleError(a){console.error("GPS Error:",a),this.onError&&this.onError(a)}notifyUpdate(){this.onUpdate&&this.onUpdate({...this.state})}async saveToOfflineStorage(){try{await d("current",this.state.coordinates)}catch(a){console.error("Failed to save offline route:",a)}}}function f(a){let b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=a%60;return b>0?`${b}:${c.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`:`${c}:${d.toString().padStart(2,"0")}`}function g(a){return a>=1e3?`${(a/1e3).toFixed(2)} km`:`${Math.round(a)} m`}function h(a){if(!isFinite(a)||0===a)return"--:--";let b=Math.floor(a),c=Math.round((a-b)*60);return`${b}:${c.toString().padStart(2,"0")}`}a.s(["GPSTracker",()=>e,"formatDistance",()=>g,"formatDuration",()=>f,"formatPace",()=>h])},60246,a=>{"use strict";let b=(0,a.i(70106).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);a.s(["Users",()=>b],60246)},210,a=>{"use strict";let b=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Clock",()=>b],41710)},74566,a=>{"use strict";let b=(0,a.i(70106).default)("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);a.s(["Navigation",()=>b],74566)},33459,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(11241);var d=a.i(96373),e=a.i(1322),f=a.i(40695),g=a.i(3130),h=a.i(46893),i=a.i(210),j=a.i(24987),k=a.i(41710),l=a.i(24669),m=a.i(21374),n=a.i(60246),o=a.i(25015);let p=(0,a.i(70106).default)("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);var q=a.i(63588),r=a.i(74566),s=a.i(81560),t=a.i(50944),u=a.i(53940),v=a.i(94632);let w=["safe","inspiring","challenging","healing","accessible","beautiful","quiet","scenic","well-lit","busy"];function x(){let a=(0,t.useParams)().routeId,[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(0),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(!1),J=(0,t.useRouter)();(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/auth/me"),b=await a.json();b.userId&&y(b.userId)}catch(a){console.error("Error getting user:",a)}})()},[]);let K=(0,d.useQuery)(e.api.routes.getRoute,a?{routeId:a}:"skip"),L=(0,d.useMutation)(e.api.routes.completeCommunityRoute),M=(0,d.useMutation)(e.api.routes.deleteRoute),N=async()=>{if(x&&confirm("Are you sure you want to delete this route? All GPS data, ratings, and reviews will be permanently removed."))try{await M({routeId:a,userId:x}),J.push("/routes")}catch(a){console.error("Error deleting route:",a),alert("Failed to delete route: "+a.message)}},O=async()=>{if(!x||0===B)return void alert("Please provide a rating");I(!0);try{await L({routeId:a,userId:x,userRating:B,userTags:D,feedback:F||void 0}),A(!1),alert("Thank you for completing this route! The creator has been awarded 5 credits.")}catch(a){alert(a.message||"Failed to submit completion")}finally{I(!1)}};if(!K)return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading route..."})]})});let P=K.duration>0?K.distance/(K.duration/60):0,Q=K.verificationCount>0?K.totalRating/K.verificationCount:K.rating;return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b sticky top-16 lg:top-0 z-10",children:(0,b.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>J.push("/routes/discover"),children:[(0,b.jsx)(i.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Discovery"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(p,{className:"w-4 h-4 mr-2"}),"Save"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>J.push(`/routes/navigate/${a}`),children:[(0,b.jsx)(r.Navigation,{className:"w-4 h-4 mr-2"}),"Navigate"]}),(0,b.jsxs)(f.Button,{size:"sm",onClick:()=>A(!0),children:[(0,b.jsx)(o.Play,{className:"w-4 h-4 mr-2"}),"Start This Route"]}),x===K?.creatorId&&(0,b.jsx)(f.Button,{variant:"destructive",size:"sm",onClick:N,children:(0,b.jsx)(s.Trash2,{className:"w-4 h-4"})})]})]})]})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-6 sm:py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-2",children:K.title}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,b.jsxs)("span",{children:["Created by ",K.creator.name]}),(0,b.jsx)("span",{children:"â€¢"}),(0,b.jsx)("span",{children:(0,v.formatDistanceToNow)(K._creationTime,{addSuffix:!0})})]})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:K.tags.map((a,c)=>(0,b.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-sm rounded-full",children:a},c))}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"w-full h-96 bg-gradient-to-br from-purple-100 to-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(j.MapPin,{className:"w-16 h-16 text-purple-600 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Route map preview"})]})})})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(l.TrendingUp,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Distance"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:(0,u.formatDistance)(K.distance)})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(k.Clock,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Duration"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:(0,u.formatDuration)(K.duration)})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(m.Star,{className:"w-4 h-4 text-yellow-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Rating"})]}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[Q.toFixed(1),"/5"]})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(n.Users,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Completed"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:K.completionCount})]})})]}),K.journalEntry&&(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsxs)("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(q.MessageSquare,{className:"w-5 h-5"}),"Creator's Notes"]}),(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:K.journalEntry})]})}),K.voiceNoteStorageId&&(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Voice Note"}),(0,b.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,b.jsx)("source",{src:`/api/files/${K.voiceNoteStorageId}`,type:"audio/webm"}),"Your browser does not support audio playback."]})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4",children:"Route Details"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(j.MapPin,{className:"w-5 h-5 text-green-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Start"}),(0,b.jsx)("p",{className:"font-medium",children:K.startLocation.name})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(j.MapPin,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"End"}),(0,b.jsx)("p",{className:"font-medium",children:K.endLocation.name})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(o.Play,{className:"w-5 h-5 text-gray-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Pace"}),(0,b.jsx)("p",{className:"font-medium",children:(0,u.formatPace)(P)})]})]})]})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4",children:"Community Feedback"}),(0,b.jsxs)("p",{className:"text-gray-600 text-sm",children:[K.verificationCount," ",1===K.verificationCount?"person has":"people have"," completed this route"]})]})})]})}),z&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:(0,b.jsx)(g.Card,{className:"max-w-2xl w-full my-8",children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Complete This Route"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Share your experience to help other women and earn credits!"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Your Rating *"}),(0,b.jsx)("div",{className:"flex gap-2",children:[1,2,3,4,5].map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>C(a),className:"focus:outline-none",children:(0,b.jsx)(m.Star,{className:`w-10 h-10 transition-colors ${a<=B?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200"}`})},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Tags (Optional)"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>{E(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${D.includes(a)?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Feedback (Optional)"}),(0,b.jsx)(h.Textarea,{placeholder:"Share your thoughts about this route...",value:F,onChange:a=>G(a.target.value),rows:4,maxLength:500}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[F.length,"/500 characters"]})]}),(0,b.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,b.jsx)("p",{className:"text-sm text-purple-900",children:"The route creator will earn 5 credits when you complete their route!"})}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>A(!1),disabled:H,className:"flex-1",children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:O,disabled:H||0===B,className:"flex-1",children:H?"Submitting...":"Submit Completion"})]})]})]})})})]})}a.s(["default",()=>x],33459)}];

//# sourceMappingURL=_30230889._.js.map