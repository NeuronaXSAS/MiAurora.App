module.exports=[24669,a=>{"use strict";let b=(0,a.i(70106).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);a.s(["TrendingUp",()=>b],24669)},81560,a=>{"use strict";let b=(0,a.i(70106).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);a.s(["Trash2",()=>b],81560)},53940,a=>{"use strict";let b="offline-routes";function c(a,b,c,d){let e=a*Math.PI/180,f=c*Math.PI/180,g=(c-a)*Math.PI/180,h=(d-b)*Math.PI/180,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(e)*Math.cos(f)*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}async function d(a,c){let d=await new Promise((a,c)=>{let d=indexedDB.open("aurora-routes",1);d.onerror=()=>c(d.error),d.onsuccess=()=>a(d.result),d.onupgradeneeded=a=>{let c=a.target.result;c.objectStoreNames.contains(b)||c.createObjectStore(b,{keyPath:"id",autoIncrement:!0})}}),e=d.transaction([b],"readwrite").objectStore(b);await new Promise((b,d)=>{let f=e.put({routeId:a,coordinates:c,timestamp:Date.now()});f.onsuccess=()=>b(),f.onerror=()=>d(f.error)}),d.close()}class e{watchId=null;state={isTracking:!1,isPaused:!1,coordinates:[],stats:{distance:0,duration:0,pace:0,elevationGain:0},startTime:null,pausedTime:0};lastSampleTime=0;lastSamplePosition=null;onUpdate=null;onError=null;start(a,b){this.state.isTracking||(this.onUpdate=a,this.onError=b||null,this.state.isTracking=!0,this.state.isPaused=!1,this.state.startTime=Date.now(),this.lastSampleTime=Date.now(),"geolocation"in navigator?this.watchId=navigator.geolocation.watchPosition(a=>this.handlePosition(a),a=>this.handleError(a),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):this.handleError({code:0,message:"Geolocation not supported"}))}pause(){this.state.isTracking&&!this.state.isPaused&&(this.state.isPaused=!0,this.notifyUpdate())}resume(){this.state.isTracking&&this.state.isPaused&&(this.state.isPaused=!1,this.state.pausedTime+=Date.now()-(this.lastSampleTime||Date.now()),this.lastSampleTime=Date.now(),this.notifyUpdate())}stop(){return null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.state.isTracking=!1,this.state.isPaused=!1,this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),{...this.state}}getState(){return{...this.state}}handlePosition(a){if(!this.state.isTracking||this.state.isPaused)return;let b={lat:a.coords.latitude,lng:a.coords.longitude,timestamp:a.timestamp,elevation:a.coords.altitude||void 0};this.shouldSample(b)&&(this.state.coordinates.push(b),this.lastSamplePosition=b,this.lastSampleTime=Date.now(),this.updateStats(),this.notifyUpdate(),this.state.coordinates.length%10==0&&this.saveToOfflineStorage())}shouldSample(a){return!!(!this.lastSamplePosition||Date.now()-this.lastSampleTime>=5e3||c(this.lastSamplePosition.lat,this.lastSamplePosition.lng,a.lat,a.lng)>=10)}updateStats(){this.state.stats.distance=function(a){if(a.length<2)return 0;let b=0;for(let d=1;d<a.length;d++)b+=c(a[d-1].lat,a[d-1].lng,a[d].lat,a[d].lng);return b}(this.state.coordinates),this.state.stats.elevationGain=function(a){if(a.length<2)return 0;let b=0;for(let c=1;c<a.length;c++){let d=a[c-1].elevation||0,e=a[c].elevation||0;e>d&&(b+=e-d)}return b}(this.state.coordinates),this.state.startTime&&(this.state.stats.duration=Math.floor((Date.now()-this.state.startTime-this.state.pausedTime)/1e3)),this.state.stats.distance>0&&this.state.stats.duration>0&&(this.state.stats.pace=this.state.stats.duration/60/(this.state.stats.distance/1e3))}handleError(a){console.error("GPS Error:",a),this.onError&&this.onError(a)}notifyUpdate(){this.onUpdate&&this.onUpdate({...this.state})}async saveToOfflineStorage(){try{await d("current",this.state.coordinates)}catch(a){console.error("Failed to save offline route:",a)}}}function f(a){let b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=a%60;return b>0?`${b}:${c.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`:`${c}:${d.toString().padStart(2,"0")}`}function g(a){return a>=1e3?`${(a/1e3).toFixed(2)} km`:`${Math.round(a)} m`}function h(a){if(!isFinite(a)||0===a)return"--:--";let b=Math.floor(a),c=Math.round((a-b)*60);return`${b}:${c.toString().padStart(2,"0")}`}a.s(["GPSTracker",()=>e,"formatDistance",()=>g,"formatDuration",()=>f,"formatPace",()=>h])},210,a=>{"use strict";let b=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},93518,a=>{"use strict";let b=(0,a.i(70106).default)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);a.s(["Award",()=>b],93518)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Clock",()=>b],41710)},53569,a=>{"use strict";let b=(0,a.i(70106).default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);a.s(["Share2",()=>b],53569)},43108,a=>{"use strict";let b=(0,a.i(70106).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);a.s(["Lock",()=>b],43108)},44494,92319,a=>{"use strict";var b=a.i(70106);let c=(0,b.default)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);a.s(["Globe",()=>c],44494);let d=(0,b.default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);a.s(["UserX",()=>d],92319)},36950,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(11241);var d=a.i(96373),e=a.i(1322),f=a.i(40695),g=a.i(3130),h=a.i(210),i=a.i(84505),j=a.i(81560),k=a.i(43108),l=a.i(44494),m=a.i(92319),n=a.i(24987),o=a.i(41710),p=a.i(24669),q=a.i(93518),r=a.i(25015),s=a.i(53569),t=a.i(50944),u=a.i(53940),v=a.i(94632);function w(){let a=(0,t.useParams)().routeId,[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),A=(0,t.useRouter)();(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/auth/me"),b=await a.json();b.userId&&x(b.userId)}catch(a){console.error("Error getting user:",a)}})()},[]);let B=(0,d.useQuery)(e.api.routes.getRoute,a?{routeId:a}:"skip"),C=(0,d.useMutation)(e.api.routes.deleteRoute),D=(0,d.useMutation)(e.api.routes.updateRoutePrivacy),E=(0,d.useMutation)(e.api.routes.shareRouteToFeed),F=async()=>{if(w)try{await C({routeId:a,userId:w}),A.push("/routes")}catch(a){console.error("Error deleting route:",a),alert("Failed to delete route")}},G=async b=>{if(w)try{await D({routeId:a,userId:w,sharingLevel:b})}catch(a){console.error("Error updating privacy:",a),alert("Failed to update privacy settings")}},H=async()=>{if(w)try{await E({routeId:a,userId:w}),alert("Route shared to feed successfully!")}catch(a){alert(a.message||"Failed to share route")}};if(!B)return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading route..."})]})});let I=B.duration>0?B.distance/(B.duration/60):0;return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b sticky top-16 lg:top-0 z-10",children:(0,b.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>A.push("/routes"),children:[(0,b.jsx)(h.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Routes"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[!B?.isPrivate&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:H,children:[(0,b.jsx)(s.Share2,{className:"w-4 h-4 mr-2"}),"Share to Feed"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{if(!B)return;let a=new Blob([`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="Aurora App">
  <metadata>
    <name>${B.title}</name>
    <desc>${B.journalEntry||""}</desc>
  </metadata>
  <trk>
    <name>${B.title}</name>
    <type>${B.routeType}</type>
    <trkseg>
${B.coordinates.map(a=>`      <trkpt lat="${a.lat}" lon="${a.lng}">
        ${a.elevation?`<ele>${a.elevation}</ele>`:""}
        <time>${new Date(a.timestamp).toISOString()}</time>
      </trkpt>`).join("\n")}
    </trkseg>
  </trk>
</gpx>`],{type:"application/gpx+xml"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`${B.title.replace(/\s+/g,"_")}.gpx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(b)},children:[(0,b.jsx)(i.Download,{className:"w-4 h-4 mr-2"}),"Export GPX"]}),w===B?.creatorId&&(0,b.jsx)(f.Button,{variant:"destructive",size:"sm",onClick:()=>z(!0),children:(0,b.jsx)(j.Trash2,{className:"w-4 h-4"})})]})]})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 sm:px-6 py-6 sm:py-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-2",children:B.title}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:B.tags.map((a,c)=>(0,b.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-sm rounded-full",children:a},c))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(p.TrendingUp,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Distance"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:(0,u.formatDistance)(B.distance)})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(o.Clock,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Duration"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:(0,u.formatDuration)(B.duration)})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(r.Play,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Pace"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:(0,u.formatPace)(I)})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(q.Award,{className:"w-4 h-4 text-gray-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Credits"})]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:B.creditsEarned})]})})]}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:"Your Rating"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"text-3xl",children:"â­".repeat(B.rating)}),(0,b.jsxs)("span",{className:"text-gray-600",children:["(",B.rating,"/5)"]})]})]})}),B.journalEntry&&(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Journal Entry"}),(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:B.journalEntry})]})}),B.voiceNoteStorageId&&(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Voice Note"}),(0,b.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,b.jsx)("source",{src:`/api/files/${B.voiceNoteStorageId}`,type:"audio/webm"}),"Your browser does not support audio playback."]})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4",children:"Route Details"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(n.MapPin,{className:"w-5 h-5 text-green-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Start"}),(0,b.jsx)("p",{className:"font-medium",children:B.startLocation.name})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(n.MapPin,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"End"}),(0,b.jsx)("p",{className:"font-medium",children:B.endLocation.name})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(o.Clock,{className:"w-5 h-5 text-gray-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Completed"}),(0,b.jsx)("p",{className:"font-medium",children:(0,v.formatDistanceToNow)(B._creationTime,{addSuffix:!0})})]})]})]})]})}),(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4",children:"Privacy Settings"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("button",{onClick:()=>G("private"),className:`w-full p-4 rounded-lg border-2 transition-colors text-left ${"private"===B.sharingLevel?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(k.Lock,{className:"w-5 h-5 mt-0.5 text-gray-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:"Private"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Only you can see this route"})]})]})}),(0,b.jsx)("button",{onClick:()=>G("anonymous"),className:`w-full p-4 rounded-lg border-2 transition-colors text-left ${"anonymous"===B.sharingLevel?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(m.UserX,{className:"w-5 h-5 mt-0.5 text-gray-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:"Anonymous"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Share without your name (coordinates fuzzed)"})]})]})}),(0,b.jsx)("button",{onClick:()=>G("public"),className:`w-full p-4 rounded-lg border-2 transition-colors text-left ${"public"===B.sharingLevel?"border-purple-600 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(l.Globe,{className:"w-5 h-5 mt-0.5 text-gray-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:"Public"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Share with your name"})]})]})})]})]})})]})}),y&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsx)(g.Card,{className:"max-w-md w-full",children:(0,b.jsxs)(g.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Delete Route?"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this route? All GPS data, ratings, and reviews will be permanently removed."}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>z(!1),className:"flex-1",children:"Cancel"}),(0,b.jsx)(f.Button,{variant:"destructive",onClick:F,className:"flex-1",children:"Delete"})]})]})})})]})}a.s(["default",()=>w])}];

//# sourceMappingURL=_66cd15eb._.js.map