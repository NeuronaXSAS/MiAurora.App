# Implementation Plan

- [x] 1. Database Schema & Backend Foundation
  - [x] 1.1 Add dailyDebates table to Convex schema âœ…
    - Add table with date, slot (1-6), category, title, sourceUrl, sourceName, imageUrl, summary, vote counts, isAutoGenerated, createdBy, isActive
    - Add indexes: by_date, by_date_slot, by_category
    - _Requirements: 1.1, 1.2, 1.3_
  - [x] 1.2 Add anonymousDebaters table to Convex schema âœ…
    - Add table with sessionHash, pseudonym, countryCode, countryFlag, interactionCount, firstSeen, lastSeen, migratedToUserId
    - Add indexes: by_session, by_pseudonym
    - _Requirements: 7.1, 7.2, 7.3_
  - [x] 1.3 Add debateVotes table to Convex schema âœ…
    - Add table with debateId, voterType, anonymousId, memberId, vote, timestamp
    - Add indexes for efficient lookups
    - _Requirements: 1.6, 1.8_
  - [x] 1.4 Add debateComments table to Convex schema âœ…
    - Add table with debateId, authorType, anonymousId, memberId, content, upvotes, downvotes, replyCount, parentId, isHidden
    - _Requirements: 1.4, 1.7_
  - [ ]* 1.5 Write property test for vote distribution sum
    - **Property 2: Vote Distribution Sum**
    - **Validates: Requirements 1.6**

- [x] 2. Daily Debates Backend (Convex Functions)
  - [x] 2.1 Create dailyDebates.ts with CRUD operations âœ…
    - createDebate (admin), getDebatesByDate, voteOnDebate, getDebateStats
    - _Requirements: 1.2, 1.6_
  - [x] 2.2 Implement auto-generation function for debates âœ…
    - Added autoGenerateDebates mutation with predefined rotating topics
    - Admin can trigger via "Auto-Generate All 6" button
    - Topics rotate daily based on day of year
    - _Requirements: 1.3_
  - [ ] 2.3 Implement credit awarding for debate participation
    - 2 credits per vote, 3 credits per comment for logged-in users
    - _Requirements: 1.8_
  - [ ]* 2.4 Write property test for credit award consistency
    - **Property 4: Credit Award Consistency**
    - **Validates: Requirements 1.8**

- [x] 3. Anonymous Identity System
  - [x] 3.1 Create IP geolocation service âœ…
    - Use free ip-api.com (45 req/min)
    - Cache results in localStorage for 24 hours
    - Fallback to "ðŸŒ Global" on failure
    - _Requirements: 1.5, 7.2_
  - [x] 3.2 Create country code to flag emoji utility âœ…
    - Convert ISO 3166-1 alpha-2 codes to emoji flags
    - _Requirements: 7.2_
  - [x] 3.3 Create anonymousDebaters.ts Convex functions âœ…
    - createAnonymousDebater, getBySession, updateInteractionCount
    - _Requirements: 7.1, 7.3_
  - [x] 3.4 Implement pseudonym uniqueness validation per thread âœ…
    - Check for duplicates before allowing comment
    - _Requirements: 7.5_
  - [ ]* 3.5 Write property test for pseudonym uniqueness
    - **Property 15: Pseudonym Uniqueness Per Thread**
    - **Validates: Requirements 7.5**

- [ ] 4. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 5. Enhanced Bias Visualization Components
  - [x] 5.1 Create BiasCard component with emotional messaging âœ…
    - Display all 5 metrics: political, gender, fake news, intent, AI
    - Use Aurora App colors (Mint/Yellow/Salmon)
    - Include translated emotional messages
    - _Requirements: 2.2, 2.3, 2.4, 2.5, 2.7, 2.9_
  - [x] 5.2 Create GenderAlertBanner component âœ…
    - Prominent banner for gender bias alerts
    - Salmon background with pulsing border for alerts
    - Mint background with heart for safe sources
    - Translated explanations
    - _Requirements: 2.3, 2.6_
  - [x] 5.3 Remove trust/don't trust voting icons from search results âœ…
    - Remove CommunityVoteButtons from landing-search.tsx
    - _Requirements: 2.1_
  - [x] 5.4 Integrate BiasCard into search results âœ…
    - Replace current bias display with new BiasCard (inline badges)
    - _Requirements: 2.8_
  - [ ]* 5.5 Write property test for bias score bounds
    - **Property 5: Bias Score Bounds**
    - **Validates: Requirements 2.4**
  - [ ]* 5.6 Write property test for credibility color mapping
    - **Property 8: Credibility Color Mapping**
    - **Validates: Requirements 2.9**

- [x] 6. Complete Internationalization (i18n)
  - [x] 6.1 Expand translation files for all 6 languages âœ…
    - English (en), Spanish (es), French (fr), Portuguese (pt), German (de), Arabic (ar)
    - Include all UI elements, buttons, labels, system messages
    - Created: pt.json, fr.json, de.json, ar.json
    - Updated: en.json, es.json with debate/bias strings
    - _Requirements: 3.1, 3.3_
  - [x] 6.2 Add translated search suggestions âœ…
    - Suggestions in user's language for Safety, Career, Health, Community
    - Updated ai-search-suggestions.tsx with full i18n for 6 languages
    - _Requirements: 3.1_
  - [x] 6.3 Add translated emotional messages âœ…
    - Gender alerts, fake news warnings, encouragement messages
    - Added to BiasCard and DailyDebatesPanel
    - _Requirements: 3.1_
  - [x] 6.4 Implement locale-aware date/number formatting âœ…
    - Created aurora-app/lib/locale-format.ts with full Intl API support
    - formatDate, formatTime, formatNumber, formatRelativeTime, formatList, formatOrdinal
    - Supports all 6 priority languages (EN, ES, FR, PT, DE, AR)
    - _Requirements: 3.5_
  - [ ]* 6.5 Write property test for translation completeness
    - **Property 9: Translation Completeness**
    - **Validates: Requirements 3.1**

- [x] 7. Daily Debates UI Components
  - [x] 7.1 Create DailyDebatesPanel component âœ…
    - Display 6 debates organized by category
    - Show vote distribution with percentages
    - Pseudonym + flag for participants
    - _Requirements: 1.1, 1.6, 1.7_
  - [x] 7.2 Create DebateCard component âœ…
    - Individual debate with title, source, summary, image
    - Vote buttons (Agree/Disagree/Neutral)
    - Comment section with threading
    - _Requirements: 1.4, 1.6_
  - [x] 7.3 Create PseudonymPrompt component âœ…
    - Modal for anonymous users to enter pseudonym
    - Auto-detect and display country flag
    - Store in localStorage
    - _Requirements: 7.1, 7.4_
  - [x] 7.4 Integrate DailyDebatesPanel into landing page âœ…
    - Added alongside DailyNewsPanel in landing-search.tsx
    - _Requirements: 1.1_
  - [ ]* 7.5 Write property test for debate count invariant
    - **Property 1: Daily Debates Count Invariant**
    - **Validates: Requirements 1.1**

- [ ] 8. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 9. Admin Panel for Debates
  - [x] 9.1 Create DailyDebatesAdmin component âœ…
    - Form to add 6 debates with news URLs
    - Category selector, title, summary, source fields
    - Preview of how debate will appear
    - _Requirements: 1.2_
  - [x] 9.2 Add Debates tab to admin dashboard âœ…
    - Integrate DailyDebatesAdmin into admin page
    - Show status of today's debates (configured vs auto-generated)
    - _Requirements: 1.2_

- [x] 10. Search-Social Network Bridge âœ…
  - [x] 10.1 Show related Aurora App discussions in search results âœ…
    - Created aurora-app/components/search/related-discussions.tsx
    - Query for posts/debates related to search topic
    - Display "X members discussing this" badge
    - Integrated into landing-search.tsx
    - _Requirements: 9.1, 9.5_
  - [x] 10.2 Implement signup prompt after 10+ interactions âœ…
    - Created aurora-app/components/signup-prompt.tsx
    - Tracks searches, votes, comments, debate views
    - Shows personalized prompt with earned credits preview
    - Full i18n support for 6 languages
    - useSignupPrompt hook for state management
    - _Requirements: 9.2_
  - [x] 10.3 Implement anonymous â†’ member migration âœ…
    - Created aurora-app/hooks/use-anonymous-migration.ts
    - Created aurora-app/components/migration-welcome.tsx
    - Updated aurora-app/lib/anonymous-session.ts with migration utilities
    - Preserve pseudonym, flag, debate history on signup
    - _Requirements: 9.3, 9.4_
  - [ ]* 10.4 Write property test for interaction threshold prompt
    - **Property 17: Interaction Threshold Signup Prompt**
    - **Validates: Requirements 9.2**

- [x] 11. Cross-Platform Visibility âœ…
  - [x] 11.1 Include trending debates in Aurora App feed âœ…
    - Updated aurora-app/convex/feed.ts to include hot debates
    - Created aurora-app/components/debate-feed-card.tsx
    - Query debates with high engagement (5+ votes)
    - Mix into feed alongside posts
    - _Requirements: 10.1_
  - [x] 11.2 Make member comments visible to anonymous users âœ…
    - Updated aurora-app/components/search/daily-debates-panel.tsx
    - Display member badges (Premium, Verified, Trust Score)
    - Visual distinction for member vs anonymous comments
    - _Requirements: 10.2, 10.3_
  - [ ]* 11.3 Write property test for member badge visibility
    - **Property 18: Member Badge Visibility**
    - **Validates: Requirements 10.3**

- [x] 12. Engagement & Celebration System âœ…
  - [x] 12.1 Create CelebrationMoment component âœ…
    - Created aurora-app/components/celebration-moment.tsx
    - Animations: confetti, hearts, sparkles, stars
    - Translated messages for 6 languages
    - Respects prefers-reduced-motion
    - _Requirements: 6.1_
  - [x] 12.2 Implement celebration triggers âœ…
    - First search (5 credits), 5 searches (10 credits), first vote (2 credits)
    - First comment (3 credits), 7-day streak (50 credits), first debate (5 credits)
    - useCelebration hook and checkMilestone utility
    - _Requirements: 6.2, 6.3_
  - [x] 12.3 Create "What you missed" summary for returning users âœ…
    - Created aurora-app/components/what-you-missed.tsx
    - Shows after 24+ hours absence
    - Highlights top debates, trending topics, community stats
    - useWhatYouMissed hook for state management
    - _Requirements: 6.1_
  - [ ]* 12.4 Write property test for streak credit calculation
    - **Property 12: Streak Credit Calculation**
    - **Validates: Requirements 6.2**

- [ ] 13. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 14. Realistic Multilingual Seed Data âœ…
  - [x] 14.1 Create seed data script for posts in 6 languages âœ…
    - Created aurora-app/convex/seedData.ts
    - 14 realistic posts in EN, ES, FR, PT, DE, AR
    - Content about safety, career, health, community
    - Run with: npx convex run seedData:seedPosts
    - _Requirements: 4.1, 4.2_
  - [x] 14.2 Create seed data for safety routes from major cities âœ…
    - Created aurora-app/convex/seedData.ts (seedRoutes function)
    - 10 routes from Paris, Tokyo, SÃ£o Paulo, Cairo, Berlin, Mexico City
    - Realistic coordinates and descriptions
    - Run with: npx convex run seedData:seedRoutes
    - _Requirements: 4.5_
  - [x] 14.3 Hide/remove empty reels and livestreams âœ…
    - Updated feed.ts to filter reels with zero engagement
    - Livestreams only shown if viewerCount > 0 OR isEmergency
    - Reels only shown if views/likes/comments > 0 OR has caption
    - _Requirements: 4.3_
  - [ ]* 14.4 Write property test for empty content filtering
    - **Property 11: Empty Content Filtering**
    - **Validates: Requirements 4.3**

- [x] 15. Map Performance Optimization âœ…
  - [x] 15.1 Implement lazy loading for map markers âœ…
    - Already implemented: requestAnimationFrame for marker batching
    - Lazy popup creation (only on hover/click)
    - Memoized marker creation functions
    - _Requirements: 5.2_
  - [x] 15.2 Optimize map tile loading âœ…
    - Already implemented: Custom Aurora Mapbox style with vector tiles
    - fadeDuration: 0 for instant tile transitions
    - renderWorldCopies: false for better performance
    - _Requirements: 5.3, 5.5_
  - [x] 15.3 Add loading skeleton for map component âœ…
    - Already implemented in lazy-map.tsx: MapLoadingSkeleton
    - Animated progress bar, grid pattern background
    - StaticMapPlaceholder for low-end devices
    - Aggressive preloading on module load
    - _Requirements: 5.1_

- [x] 16. Final Integration & Polish (Partial) âœ…
  - [ ] 16.1 Ensure all components use translated strings
    - Audit all hardcoded strings
    - Replace with translation keys
    - _Requirements: 3.1_
  - [x] 16.2 RTL layout support for Arabic âœ…
    - Created aurora-app/lib/rtl-utils.ts with RTL utilities
    - Added comprehensive RTL CSS rules to globals.css
    - Supports direction flipping, margin/padding, positioning
    - Locale-context already has isRTL support
    - _Requirements: 3.3_
  - [ ] 16.3 Performance audit and optimization
    - Lighthouse score > 90
    - Bundle size optimization
    - _Requirements: 5.1, 5.4_

- [ ] 17. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.
